<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>网规基础9网络层协议 | JYhe</title><meta name="keywords" content="网络规划设计师,基础知识"><meta name="author" content="JYhe"><meta name="copyright" content="JYhe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="网规基础9网络层协议"><meta name="application-name" content="网规基础9网络层协议"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="网规基础9网络层协议"><meta property="og:url" content="http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/index.html"><meta property="og:site_name" content="JYhe"><meta property="og:description" content="IP 协议 IP 协议是Internet 中的网络层协议，提供无连接服务。 IP 协议数据单元 IP 协议的数据格式如图所示，其中的字段如下  • 版本号：协议的版本号，不同版本的协议格式或语义可能不同，现在常用的是1Pv4, 正在逐渐过渡到IPV6。 • IHL: IP 头长度，以 32位宇计数，"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/img/default_cover.jpg"><meta property="article:author" content="JYhe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/default_cover.jpg"><meta name="description" content="IP 协议 IP 协议是Internet 中的网络层协议，提供无连接服务。 IP 协议数据单元 IP 协议的数据格式如图所示，其中的字段如下  • 版本号：协议的版本号，不同版本的协议格式或语义可能不同，现在常用的是1Pv4, 正在逐渐过渡到IPV6。 • IHL: IP 头长度，以 32位宇计数，"><link rel="shortcut icon" href="/img/JYHE.jpg"><link rel="canonical" href="http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: JYhe","link":"Link: ","source":"Source: JYhe","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'JYhe',
  title: '网规基础9网络层协议',
  postAI: '',
  pageFillDescription: 'IP 协议, IP 协议数据单元, IP 地址与子网划分, IPv6 协议, IPv6 地址自动配置, 邻节点发现过程, ICMP 协议, ARP 协议, ARP 分组格式, 代理ARP, 路由协议, 路由信息协议（RIP), 开放最短路径优先协议（OSPF), IS-IS 路由协议, 核心网关协议, 路由器技术, NAT 技术协议协议是中的网络层协议提供无连接服务协议数据单元协议的数据格式如图所示其中的字段如下版本号协议的版本号不同版本的协议格式或语义可能不同现在常用的是正在逐渐过渡到头长度以位宇计数最小为即个字节服务类型用于区分不同的可靠性优先级延迟和吞吐率的参数总长度包含头在内的数据单元的总长度宇节数标识符唯一标识数据报的标识符标志包括个标志一个是标志用于分段和重装配另一个是禁止分段标志如果认为目标站不具备重装配能力则可使这个标志置位这样如果数据报要经过一个最大分组长度较小的网络就会被丢弃因而最好使用源路由以避免这种灾难发生第个标志当前没有启用段偏置值指明该段处于原来数据报中的位置生存期用经过的路由器个数表示协议上层协议或头校检和对头的校验序列在数据报传输过程中头中的某些字段可能改变例如生存期以及与分段有关的宇段所以校检和要在每一个经过的路由器中进行校验和重新计算校检和是对头中的所有位字进行的补码相加得到的计算时假定校检和字段本身为源地址给网络和主机地址分别分配若干位例如和和和等目标地址同上任选数据可变长包含发送者想要发送的任何数据补丁补齐位的边界用户数据以宇节为单位的用户数据和头加在一起的长度不超过字节地址与子网划分网络地址采用网络主机的形式其中网络部分是网络的地址编码主机部分是网络中一个主机的地址编码地址的格式如图所示地址分为类类类类是常用地址地址的编码规定全表示本地地址即本地网络或本地主机全表示广播地址任何网站都能接收所以除去全和全地址外类有个网络地址万个主机地址类有个网络地址个主机地址类有万个网络地址个主机地址地址通常用十进制数表示即把整个地址划分为个字节每个字节用一个十进制数表示中间用圆点分隔根据地址的第一个字节就可判断它是类类还是类地址子网划分把主机地址部分再划分为子网地址和主机地址形成了三级寻址结构这种三级寻址方式需要子网掩码的支持子网地址对网络外部是透明的当分组到达目标网络后网络边界路由器把位的地址与子网掩码进行逻辑与运算从而得到子网地址并据此转发到适当的子网中图所示为类网络地址被划分为两个子网的情况虽然子网掩码是对网络编址的有益补充但是还存在着一些缺陷例如一个组织有几个包含台左右计算机的子网又有一些只包含几台计算机的较小的子网在这种情况下如果将一个类地址分成个子网每个子网可以包含台计算机大的子网基本上利用了全部地址但是小的子网却浪费了许多地址为了解决这个问题避免任何可能的地址浪费就出现了可变长子网掩码的编址方案这样可以在地址后面加上位数来表示子网掩码中的个数例如的前位表示网络号和子网号即子网掩码为位长主机地址为位长协议协议的特点更大的地址空间将地址从的增大到了扩展的地址层次结构灵活的首部格式改进的选项增强安全性对支持地址将地址空间分为两大部分如图所示第一部分是可变长度的类型前缀它定义了地址的目的第二部分是地址的其他部分其长度也是可变的网络规划设计师地址格式每个的值用十六进制值表示各值之间用冒号分隔数据报的目的地址可以是以下三种基本类型地址之一单播单播就是传统的点对点通信多播多播是一点对多点的通信任播这是增加的一种类型任播的目的站是一组计算机但数据报在交付时只交付给其中的一个通常是距离最近的一个前缀为是保留一小部分地址与兼容的这是因为必须要考虑在比较长的时期和将会同时存在而有的结点不支持扩展了地址的分级概念使用以下三个等级第一级顶级指明全球都知道的公共拓扑第二级地点级指明单个的地点第三级指明单个的网络接口报文格式数据报首部格式如图所示数据报各字段说明如下的基本首部具体包括版本它指明了协议的版本对该字段总是流量类型这是为了区分不同的数据报的类别或优先级流标签用于源节点标识路由器需要特殊处理的包序列载荷长度它指明数据报除基本首部以外的字节数所有扩展首部都算在有效载荷之内其最大值是下个首部它相当于的协议字段或可选字段跳数限制源站在数据报发出时即设定跳数限制路由器在转发数据报时将跳数限制宇段中的值减当跳数限制的值为零时就要将此数据报丢弃源地址指明生成数据包的主机的地址目的地址指明数据包最终要到达的目的主机的地址的扩展首部将原来首部中选项的功能都放在扩展首部中并将扩展首部留给路径两端的源站和目的站的主机来处理数据报途中经过的路由器都不处理这些扩展首部只有一个首部例外即逐跳选项扩展首部这样就大大提高了路由器的处理效率在中定义了六种扩展首部逐跳选项此扩展头必须紧跟在基本首部之后它包含所经路径上的每一个节点都必须检查的选项数据由于它需要在每个中间路由器都进行处理所以只有在绝对必要的时候才出现路由选择此扩展头指明数据包在到达目的地途中将经过的各节点的地址列表分片当源地址发送的数据包比到达目的地址所经过的路径上的最小还要大时这个数据包就要被分成几段分别发送这时就要用到分片头鉴别鉴别头的功能是实现了数据的完整性和对数据来源的认证封装安全有效载荷封装安全有效载荷头提供数据加密功能实现端到端的加密提供无连接的完整性和防重发服务封装安全有效载荷头可以单独使用也可以在使用隧道模式时嵌套使用目的站选项目的站选项头中携带仅需要最终目的节点检验的可选信息它要在目的地址域所列的第一个目的主机上处理也要在路由头所列的后续目的主机上处理地址自动配置中地址自动配置有两种方式有状态地址自动配置和无状态地址自动配置当站点并不是特别关心主机所使用的精确地址时只要它们是唯一的井且是可路由的就能使用无状态方式当站点严格控制地址分配时就使用有状态方式有状态地址自动配置在这种模式下主机可以从服务器获得接口地址也可以从服务器上获得配置信息和参数服务器中维护着一个数据库其中记录着主机和地址分配的列表比较常用的是协议即支持的动态主机配置协议它允许服务器把诸如网络地址等信息传给节点服务器与客户端使用来交换报文服务器和中继代理使用端口来监昕报文客户端使用端口来监听报文无状态地址自动配置这种模式要求本地链路支持组擂而且网络接口能够发送和接收组播包采用这种方式可以为任意主机配置一个地址这个地址内嵌一个以太网地址由于以太网地址全球唯一因此获得的地址也是唯一的具体过程如下首先进行自动配置的节点必须确定自己的链路本地地址然后必须验证该链路本地地址在链路上的唯一性最后节点必须确定需要配置的信息该信息可能是节点的地址或者是其他配置信息或者两者皆有具体地说在无状态地址自动配置过程中主机首先通过将它的网卡地址附加在链路本地地址前缀之后产生一个链路本地单播地址已经将网卡地址由位改为了位如果主机采用的网卡的地址依然是位那么网卡驱动程序会根据的一个公式将位地址转换为位地址接着主机向该地址发出一个邻居发现请求以验证地址的唯一性如果请求没有得到响应则表明主机自我配置的链路本地单播地址是唯一的否则主机将使用一个随机产生的接口组成一个新的链路本地单播地址然后以该地址为源地址主机向本地链路中所有路由器多点传送一个路由器请求来请求配置信息路由器以一个包含一个可聚集全球单播地址前缀和其他相关配置信息的路由器宣告作为响应主机用它从路由器得到的全球地址前缀加上自己的接口自动配置全球地址然后就可以与中的其他主机通信了如果本地网络孤立于其他网络则节点必须寻找配置服务器来完成其配置否则节点必须侦听路由器宣告报文这些报文周期性地发往所有主机的组播地址以指明诸如网络地址和子网地址等配置信息节点可以等待路由器宣告也可以通过发送组播请求给所有路由器的组播地址来请求路由器发送宣告一旦收到路由器的响应节点就可以使用响应的信息来完成自动配置邻节点发现过程邻居发现协议使用一系列的控制信息报文来实现相邻节点的信息交互管理井在一个子网中保持网络层地址和链路层地址之间的映射邻居发现协议中定义了种类型的信息路由器宣告路由器请求路由重定向邻居请求和邻居宣告邻节点发现过程具体如下路由器发现即帮助主机来识别本地路由器前缀发现节点使用此机制来确定指明链路本地地址的地址前缀以及必须发送给路由器转发的地址前缀参数发现帮助节点确定诸如本地链路之类的信息地址自动配置用于节点自动配置地址解析替代了和帮助节点从目的地址中确定本地节点即邻居的链路层地址下一跳确定可用于确定包的下一个目的地即可确定包的目的地是否在本地链路上如果在本地链路下一跳就是目的地否则包需要选路下一跳就是路由器邻居发现可用于确定应使用的路由器邻居不可达检测帮助节点确定邻居目的节点或路由器是否可达重复地址检测帮助节点确定它想使用的地址在本地链路上是否己被占用重定向有时节点选择的转发路由器对于待转发的包而言并非最佳这种情况下该转发路由器可以对节点进行重定向使它将包发送给更佳的路由器协议与协议同属于网络层用于传送有关通信问题的消息例如数据报不能到达目标站路由器没有足够的缓存空间或者路由器向发送主机提供最短通路信息等报文封装在数据报中传送因而不保证可靠的提交报文有种之多报文格式如图所示其中类型字段表示报文的类型代码字段可表示报文的少量参数当参数较多时写入位的参数字段报文携带的信息包含在可变长的信息字段中校验和宇段是关于整个报文的校验和报文包括以下类型目标不可到达类型如果路由器判断出不能把数据报送达目标主机则向源主机返回这种报文另一种情况是目标主机找不到有关的用户协议或上层服务访问点也会返回这种报文出现这种情况的原因可能是头中的字段不正确或者是数据报中说明的源路由无效也可能是路由器必须把数据报分段但头中的标志己置位超时类型路由器发现数据报的生存期已超时或者目标主机在一定时间内无法完成重装配则向源端返回这种报文源抑制类型这种报文提供了一种流量控制的初等方式如果路由器或目标主机缓冲资源耗尽而必须丢弃数据报则每丢弃一个数据报就向源主机发回一个源抑制报文这时源主机必须减小发送速度另外一种情况是系统的缓冲区已用完并预感到行将发生拥塞则发出源抑制报文但是与前一种情况不同涉及的数据报尚能提交给目标主机参数问题类型如果路由器或主机判断出头中的字段或语义出错则返回这种报文报文头中包含一个指向出错字段的指针路由重定向类型路由器向直接相连的主机发出这种报文告诉主机一个更短的路径例如路由器收到本地网络上主机发来的数据报检查它的路由表发现要把数据报发往网络必须先转发给路由器而又与源主机在同一网络中于是向源主机发出路由重定向报文把的地址告诉它回声请求响应类型用于测试两个节点之间的通信线路是否畅通收到回声请求的节点必须发出回声响应报文该报文中的标识符和序列号用于匹配请求和响应报文当连续发出回声请求时序列号连续递增常用的工具就是这样工作的时间戳请求响应类型用于测试两个节点之间的通信延迟时间请求方发出本地的发送时间响应方返回自己的接收时间和发送时间这种应答过程如果结合强制路由的数据报实现则可以测量出指定线路上的通信延迟地址掩码请求响应类型主机可以利用这种报文获得它所在的的子网掩码首先主机广播地址掩码请求报文同一上的路由器以地址掩码响应报文回答告诉请求方需要的子网掩码了解子网掩码可以判断出数据报的目标节点与源节点是否在同一中协议地址是分配给主机的逻辑地址在因特网络中表示唯一的主机似乎有了地址就可以方便地访问某个子网中的某个主机寻址问题就解决了其实不然还必须考虑主机的物理地址问题由于互连的各个子网可能源于不同的组织运行不同的协议异构性因而可能采用不同的编址方法任何子网中的主机至少都有一个在子网内部唯一的地址这种地址都是在子网建立时一次性指定的甚至可能是与网络硬件相关的我们把这个地址叫作主机的物理地址或硬件地址物理地址和逻辑地址的区别可以从两个角度看从网络互连的角度看逻辑地址在整个因特网络中有效而物理地址只是在子网内部有效从网络协议分层的角度看逻辑地址由层使用而物理地址由子网访问子层具体地说就是数据链路层使用由于有两种主机地址因此需要一种映像关系把这两种地址对应起来在中是用地址分解协议来实现逻辑地址到物理地址映像的分组格式分组的格式如图所示各字段的含义解释如下硬件类型网络接口硬件的类型对以太网此值为协议类型发送方使用的协议表示协议硬件地址长度对以太网地址长度为字节协议地址长度对协议地址长度为字节操作请求响应请求响应通常应用程序把要发送的报文交给协议当然知道接收方的逻辑地址否则就不能通信了但不一定知道接收方的物理地址在把分组向下传送给本地数据链路实体之前可以用两种方法得到目标物理地址查本地内存的地址映像表通常地址映像表的逻辑结构如表所示可以看出这是地址和以太网地址的对照表如果表查不到就广播一个请求分组这种分组可经过路由器进一步转发到达所有连网的主机它的含义是如果你的地址是这个分组的目标地址请回答你的物理地址是什么收到该分组的主机一方面可以用分组中的两个源地址更新自己的地址映像表另一方面用自己的地址与目标地址宇段比较若相符则发回一个响应分组向发送方报告自己的硬件地址若不相符则不予回答代理所谓代理就是路由器假装目标主机来回答请求所以源主机必须先把数据帧发给路由器再由路由器转发给目标主机这种技术不需要配置默认网关也不需要配置路由信息就可以实现子网之间的通信用于说明代理的例子如图所示设子网上的主机需要与子网上的主机通信图中的主机有一个位的子网掩码这意味着主机认为它直接连接到网络当主机需要与它直接连接的设备通信时它就向目标发送一个请求当主机需要主机的地址时它在子网上广播的请求分组如下这个请求的含义是要求主机回答它的地址请求分组被包装在以太帧中其源地址是的地址而目标地址是广播地址由于路由器不转发广播帧所以这个请求只能在子网中传播到不了主机如果路由器知道目标地址在另外一个子网中它就以自己的地址回答主机路由器发送的应答分组如下这个应答分组封装在以太帧中以路由器的地址为源地址以主机的地址为目标地址应答帧是单播传送的在接收到应答后主机就将它的表更新如下从此以后主机就把所有给主机的分组发送给地址为的主机这就是路由器的网卡地址通过这种方式子网中的映像表都把路由器的地址当作子网中主机的地址例如主机的映像表如下多个地址被映像到一个地址这一事实正是代理的标志是反向协议即由硬件地址查找逻辑地址通常主机的地址保存在硬盘上机器关电时也不会丢失系统启动时自动读入内存中但是无盘工作站无法保存地址它的地址由服务器保存当无盘工作站启动时广播一个请求分组把自己的硬件地址同时写入发送方和接收方的硬件地址字段中服务器接收这个请求并填写目标地址字段把操作字段改为响应分组送回请求的主机路由协议因特网由不同的自治系统互连而成自治系统内采用内部网关协议进行路由选择可能选择不同的路由表不同的路由选择算法在不同自治系统之间用外部网关协议交换路由信息例如若干个校园网通过广域网互连就是这种情况如图所示常用内部路由协议包括路由信息协议开放最短路径优先协议中间系统到中间系统的协议内部网关路由协议和增强的协议外部网关协议有协议路由信息协议是一种分布式的基于距离向量的路由选择协议该协议定义距离就是经过的路由器的数目距离最短的路由就是最好的路由它允许一条路径最多只能包含个路由器限制了网络的规模距离的最大值为时即为不可达所以不能在两个网络之间同时使用多条路由来进行负载均衡协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录并依此来形成自己的路由表且按固定时间一般为和相邻路由器交换路由表协议属于应用层协议它使用传输层的用户数据报进行传送协议的格式及它和协议的关系如图所示协议中的命令字段指出报文的意义地址类别字段指出所使用的地址协议当使用地址时该字段的值为路由标记字段应该写入自治系统号一个报文最大长度为字节这是因为一个报文的路由部分最多可包含个路由信息当超过字节的最大长度时就应该再用一个报文来传送的特点是好消息传播得快坏消息传播得慢它的意思是如果路由器发现了一个更短的路由这个消息可以很快得以传播但如果网络出现了故障这样的消息会传播得很慢开放最短路径优先协议协议是分布式的链路状态路由协议链路在这里代表该路由器和哪些路由器是相邻的即通过一个网络是可以连通的链路状态说明了该通路的连通状态以及距离时延带宽等参数在该协议中只有当链路状态发生变化时路由器才用洪泛法向所有路由器发送路由信息所发送的信息是与本路由器相邻的所有路由器的链路状态为了保存这些链路状态信息每个路由器都会建立一个链路状态数据库因为路由器交换信息时使用的是洪泛法所以每个路由器都存有全网的链路状态信息也就是说每个路由器都知道整个网络的连通情况和拓扑结构这样每个路由器都可以根据链路状态数据库的信息来构造自己的路由表为了及时了解链路的状态情况每个路由器需要定期向邻居路由器发送分组如果秒钟还没有收到邻居的信息则认为该邻居是不连通的应该立即修改链路状态数据库中所对应的记录并重新计算路由表除了问候分组外协议还有四种分组链路状态更新分组链路状态确认分组链路状态描述分组和链路状态请求分组通过这四种分组达到全网链路数据库的同步链路状态更新分组是正常情况下当链路状态发生变化时使用洪泛法所发送的分组链路状态确认分组是对链路状态更新分组的确认链路状态描述分组是当路由器启动一条新的通路时向邻居路由器所发送的分组链路状态请求分组是在与邻居路由器交换了链路状态描述分组后还需要其他自己缺少的路由信息时所使用的分组协议的格式及它与协议的关系如图所示协议使用洪泛法向网络中所有路由器发送链路状态信息为了减小洪泛范围协议对网络进行了区域划分这在协议首部的区域标识符宇段体现了出来路由协议中间系统到中间系统路由协议最初是国际标准化组织为无连接网络协议设计的一种动态路由协议为了提供对路由的支持通过对进行扩充和修改使能够同时应用在环境中形成了集成化用于城域网和承载网中协议也是基于链路状态并使用最短路径优先算法进行路由计算的一种协议具有多路由类型多区域类型根据带宽设定开销规则网络类型多样等特点多用园区网中则具有算法快速报文结构简便快速建立邻居关系以及大容量路由传递等一系列特点在骨干网有着天然的优势路由器类型在中路由器可以分为三种类型路由器路由器路由器路由器特点如下路由器是一个普通区域内部的路由器只能在非骨干区域中存在路由器只能与属于同一区域的和路由器建立邻接关系不能与路由器建立邻接关系交换路由信息并维护和管理本区域内部的一个的路由器的邻居都在同一个区域中其包含本区域的路由信息以及到达同一区域中最近路由器相当于中的的缺省路由但到区域外的数据需由最近的路由器进行转发也就是说路由器只能转发区域内的报文或者将到达其他区域的报文转发到距离它最近且在同一区域的路由器路由器特点如下路由器是骨干区域中的路由器主要用于通过与普通区域中的路由器连接连接骨干区域和非骨干区域类似于网络中的骨干路由器并负责在不同区域间的通信路由器负责区域间的路由它可以与相同或者不同区域的路由器或者不同区域的路由器形成邻居关系路由器维护一个的该包含区域间的路由信息路由器只可能建立的邻接关系网络中的所有口路由器和所有路由器连接在一起共同构成网络的骨干网注意不是骨干区域也称区域中的区域不是一个特定的区域是由连接网络中各个区域的一部分路由器组成的但必须是连续的路由器特点如下路由器类似于网络中的区域边界路由器用于区域间的连接路由器既可以与同一普通区域的路由器以及其他路由器建立邻接关系也可以与骨干区域路由器建立邻接关系路由器必须通过路由器才能与其他区域通信路由器必须维护以下两个用于区域内路由用于区域间路由但要注意的是路由器不一定要位于区域边界在区域内部也有可能存在路由器网络分层路由域为了支持大规模的路由网络在自治系统内采用骨干区域与非骨干区域两级分层结构如图所示一般来说将路由器部署在非骨干区域将路由器和路由器部署在骨干区域每一个非骨干区域都通过路由器与骨干区域相连在中骨干区域固定为且非骨干区域要和骨干区域相连没有通过物理连接的话则要进行虚连接但是在中可以有多个骨干区域且区域不固定非骨干区域必须和骨干区域物理相连通过路由器非骨干区域之间不能直接连接级别的路由器可以属于不同的区域在区域维护的在区域维护的外部网关协议是不同自治系统的路由器之间交换路由信息的协议由于的规模太大使得自治系统之间路由选择非常困难另外对于自治系统之间的路由选择要寻找最佳路由是不现实的所以只是尽力寻找一条能够到达目的网络且比较好的路由不能兜圈子而不像内部网关协议一样要寻找一条最佳路由每一个自治系统的管理员要选择至少一个路由器作为该自治系统的发言人发言人往往就是边界路由器但也可以不是边界路由器通常两个发言人都是通过一个共享网络连接在起的当一个发言人与其他自治系统中的发言人交换路由信息时首先要建立连接然后在此连接上交换报文以建立会话利用会话交换路由信息在刚刚运行时的邻站是交换整个的路由表但以后只需要在发生变化时更新有变化的部分这样做对节省网络带宽和减少路由器的处理开销方面都有好处发言人互相交换网络可达性的信息后各发言人就可找出到达各自治系统的比较好的路由共使用四种报文打开报文用来与相邻的另一个发言人建立关系更新报文用来发送某一路由的信息以及列出要撤销的多条路由保活报文用来确认打开报文和周期性地证实邻站关系通知报文用来发送检测到的差错协议的格式及它与和协议的关系如图所示核心网关协议中有一个主干网所有的自治系统都连接到主干网上这样的总体结构如图所示分为主干网和外围部分后者包含所有的自治系统主干网中的网关叫核心网关核心网关之间交换路由信息时使用核心网关协议这里要区分和用于两个不同自治系统之间的网关交换路由信息而是主干网中的网关协议因为主干网中的核心网关是由直接控制的所以更具有专用性当一个核心网关加入主干网时用协议向邻机广播发送路由信息各邻机更新路由表并进一步传播新的路由信息网关交换的路由信息与协议类似指明网关连接哪些网络距离是多少距离也是以中间网关个数计数协议的报文格式与类似报文分为以下类路由更新报文发送路由信息应答报文对路由更新报文的应答分肯定否定两种测试报文测试相邻网关是否存在网络接口状态报文测试本地网络连接的状态路由器技术技术技术主要解决地址短缺问题最初提出的建议是在子网内部使用局部地址而在子网外部使用少量的全局地址通过路由器进行内部和外部地址的转换局部地址是在子网内部独立编址的可以与外部地址重叠这种想法的基础是假定在任何时候子网中只有少数计算机需要与外部通信可以让这些计算机共享少量的全局地址后来根据这种技术叉开发出其他一些应用下面介绍两种最主要的应用第一种应用是动态地址翻译为此首先引入存根域的概念所谓存根域就是内部网络的抽象这样的网络只处理源和目标都在子网内部的通信任何时候存根域内只有一部分主机要与外界通信甚至还有许多主机可能从不与外界通信所以整个存根域只需共享少量的全局地址存根域有一个边界路由器由它来处理域内主机与外部网络的通信在此做以下假定需要翻译的内部地址数可用的全局地址数地址当翻译满足条件且时可以把一个大的地址空间映像到一个小的地址空间所有地址放在二个缓冲区中并在存根域的边界路由器中建立一个局部地址和全局地址的动态映像表如图所示这个图显示的是把所有类网络中的地址翻译成类网络中的地址这种地址重用有以下特点只要缓冲区中存在尚未使用的类地址任何从内向外的连接请求都可以得到响应并且在边界路由器的动态表为之建立一个映像表项如果内部主机的映像存在可以利用它建立连接从外部访问内部主机是有条件的即动态表中必须存在该主机的映像动态地址翻译的好处是节约了全局地址而且不需要改变子网内部的任何配置只需在边界路由器中设置一个动态地址变换表就可以工作了另外一种特殊的应用是翻译这种技术也叫作伪装因为用一个路由器的地址可以把子网中所有主机的地址都隐藏起来如果子网中有多个主机同时都要通信那么还要对端口号进行翻译所以这种技术经常被称为网络地址和端口翻译在很多实现中专门保留一部分端口号给伪装使用叫作伪装端口号图中的路由器中有一个伪装表通过这个表对端口号进行翻译从而隐藏了内部网络中的所有主机',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-12-14 16:38:46',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/JYHE.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">JYhe</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>9</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" style="font-size: 1.05rem;">网络规划设计师<sup>9</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">December 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">November 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">October 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92/" itemprop="url">网络规划</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络规划设计师</span></a><a class="article-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>基础知识</span></a></span></div></div><h1 class="post-title" itemprop="name headline">网规基础9网络层协议</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-11-27T05:42:00.000Z" title="Created 2025-11-27 13:42:00">2025-11-27</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-12-14T08:38:46.872Z" title="Updated 2025-12-14 16:38:46">2025-12-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广东</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/default_cover.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92/" itemprop="url">网络规划</a><a href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" tabindex="-1" itemprop="url">网络规划设计师</a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url">基础知识</a><h1 id="CrawlerTitle" itemprop="name headline">网规基础9网络层协议</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">JYhe</span><time itemprop="dateCreated datePublished" datetime="2025-11-27T05:42:00.000Z" title="Created 2025-11-27 13:42:00">2025-11-27</time><time itemprop="dateCreated datePublished" datetime="2025-12-14T08:38:46.872Z" title="Updated 2025-12-14 16:38:46">2025-12-14</time></header><h2 id="IP-协议">IP 协议</h2>
<p>IP 协议是Internet 中的网络层协议，提供无连接服务。</p>
<h3 id="IP-协议数据单元">IP 协议数据单元</h3>
<p>IP 协议的数据格式如图所示，其中的字段如下</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/IP%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F.png" alt=""></p>
<p>• 版本号：协议的版本号，不同版本的协议格式或语义可能不同，现在常用的是1Pv4,<br>
正在逐渐过渡到IPV6。<br>
• IHL: IP 头长度，以 32位宇计数， 最小为 5，即 20个字节。<br>
服务类型：用于区分不同的可靠性、优先级、延迟和吞吐率的参数。<br>
•总长度：包含IP头在内的数据单元的总长度（宇节数）<br>
•标识符：唯一标识数据报的标识符。<br>
•标志： 包括3个标志， 一个是M标志，用于分段和重装配； 另一个是禁止分段标志，<br>
如果认为目标站不具备重装配能力，则可使这个标志置位，这样如果数据报要经过一<br>
个最大分组长度较小的网络， 就会被丢弃， 因而最好使用源路由以避免这种灾难发生；<br>
第3个标志当前没有启用。<br>
•段偏置值： 指明该段处于原来数据报中的位置。<br>
•生存期：用经过的路由器个数表示。<br>
•协议： 上层协议（TCP或UDP） 。<br>
•头校检和：对IP头的校验序列。在数据报传输过程中IP头中的某些字段可能改变（例<br>
如生存期，以及与分段有关的宇段） ， 所以校检和要在每一个经过的路由器中进行校<br>
验和重新计算。 校检和是对IP头中的所有 16位字进行1的补码相加得到的，计算时<br>
假定校检和字段本身为0。<br>
•源地址： 给网络和主机地址分别分配若干位， 例如7和24、 14和 16、 21 和8等。<br>
•目标地址： 同上。<br>
•任选数据： 可变长，包含发送者想要发送的任何数据。<br>
•补丁： 补齐32位的边界。<br>
•用户数据：以宇节为单位的用户数据，和IP头加在一起的长度不超过65535字节。</p>
<h3 id="IP-地址与子网划分">IP 地址与子网划分</h3>
<p>IP 网络地址采用 “网络·主机”的形式，其中网络部分是网络的地址编码， 主机部分是网 络中一个主机的地址编码。 IP地址的格式如图所示</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/IP%E5%9C%B0%E5%9D%80%E7%9A%84%E6%A0%BC%E5%BC%8F.png" alt=""><br>
IP 地址分为5类。 A类、 B类、 C类是常用地址。 IP地址的编码规定全0表示本地地址， 即本地网络或本地主机： 全l表示广播地址，任何网站都能接收。 所以，除去全0和全l地址 外， A类有 126个网络地址， 1600万个主机地址： B类有 16382个网络地址， 64000个主机地 址： C类有200万个网络地址， 254个主机地址。<br>
IP 地址通常用十进制数表示，即把整个地址划分为4个字节， 每个字节用一个十进制数表示，中间用圆点分隔。根据IP地址的第一个字节， 就可判断它是A类、 B类还是C类地址。 子网划分把主机地址部分再划分为子网地址和主机地址，形成了三级寻址结构。 这种三级寻址方式需要子网掩码的支持<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81.png" alt=""><br>
子网地址对网络外部是透明的。当IP分组到达目标网络后，网络边界路由器把32位的IP 地址与子网掩码进行逻辑“与”运算，从而得到子网地址，并据此转发到适当的子网中。 图所示为B类网络地址被划分为两个子网的情况<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81.png" alt=""><br>
虽然子网掩码是对网络编址的有益补充，但是还存在着一些缺陷。 例如，一个组织有几个 包含 25 台左右计算机的子网，又有一些只包含几台计算机的较小的子网。在这种情况下，如果将一个C类地址分成6个子网，每个子网可以包含30 台计算机，大的子网基本上利用了全部地址，但是小的子网却浪费了许多地址。为了解决这个问题，避免任何可能的地址浪费，就 出现了可变长子网掩码（Variable Length Subnetwork Mask, VLSM）的编址方案。这样，可以 在IP 地址后面加上“／位数”来表示子网掩码中“1”的个数。例如， 202.117.125.0/27 的前 27 位表示网络号和子网号，即子网掩码为27位长， 主机地址为5位长。</p>
<h3 id="IPv6-协议">IPv6 协议</h3>
<p>IPv6 协议的特点<br>
•更大的地址空间。 IPv6 将地址从 IPv4 的 32bit 增大到了 128bit<br>
•扩展的地址层次结构。<br>
•灵活的首部格式。<br>
•改进的选项。<br>
•增强安全性。<br>
•对QoS支持。<br>
IPv6 地址 IPv6 将 128 bit 地址空间分为两大部分， 如图所示。第一部分是可变长度的类型前缀， 它定义了地址的目的。 第二部分是地址的其他部分， 其长度也是可变的</p>
<p>![](/img/网络规划设计师/(IPv6地址格式.png)</p>
<p>每个 16bit 的值用十六进制值表示， 各值之间用冒号分隔。<br>
IPv6 数据报的目的地址可以是以下三种基本类型地址之一：<br>
•单播 (unicast)。 单播就是传统的点对点通信。<br>
•多播 (multicast） 。 多播是一点对多点的通信。<br>
•任播 (anycast） 。 这是 IPv6 增加的一种类型。 任播的目的站是一组计算机， 但数据报在交付时只交付给其中的一个，通常是距离最近的一个。<br>
前缀为 0000 0000 是保留一小部分地址与 IPv4 兼容的，这是因为必须要考虑在比较长的时期， IPv4 和 IPv6 将会同时存在，而有的结点不支持 IPv6<br>
IPv6 扩展了地址的分级概念，使用以下三个等级：<br>
<strong>•第一级（顶级)，指明全球都知道的公共拓扑。</strong><br>
<strong>•第二级（地点级)，指明单个的地点。</strong><br>
<strong>•第三级，指明单个的网络接口。</strong><br>
IPv6 报文格式 IPv6 数据报首部格式如图所示。<br>
IPv6 数据报各字段说明如下。<br>
IPv6 的基本首部， 具体包括：<br>
•版本（version) : 4 bit，它指明了协议的版本，对 IPv6 该字段总是 6。<br>
•流量类型 (Traffic Class) : 8 bit，这是为了区分不同的 IPv6 数据报的类别或优先级。<br>
•流标签 (Flow Label) : 20bit，用于源节点标识IPv6 路由器需要特殊处理的包序列。<br>
•载荷长度（Payload Length) : 16 bit，它指明 IPv6 数据报除基本首部以外的字节数 （所有扩展首部都算在有效载荷之内） ， 其最大值是 64KB。<br>
• 下个首部（NextHead) : 8 bit。 它相当于 IPv4 的协议字段或可选字段。<br>
• 跳数限制 （HopLimit) : 8 bit。源站在数据报发出时即设定跳数限制。 路由器在转发 数据报时将跳数限制宇段中的值减1。 当跳数限制的值为零时， 就要将此数据报丢弃。<br>
• 源地址（SourceAddress) : 128bit， 指明生成数据包的主机的 IPv6 地址。<br>
•目的地址（Destination Address) : 128bit， 指明数据包最终要到达的目的主机的 IPv6 地址。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png" alt=""><br>
(2) IPv6 的扩展首部。 IPv6 将原来 IPv4 首部中选项的功能都放在扩展首部中，并将扩展 首部留给路径两端的源站和目的站的主机来处理。数据报途中经过的路由器都不处理这些扩展 首部（只有一个首部例外，即逐跳选项扩展首部），这样就大大提高了路由器的处理效率。 在［RFC 2460］中定义了六种扩展首部：<br>
• 逐跳选项： 此扩展头必须紧跟在IPv6基本首部之后， 它包含所经路径上的每一个节点 都必须检查的选项数据。 由于它需要在每个中间路由器都进行处理，所以只有在绝对 必要的时候才出现。<br>
• 路由选择： 此扩展头指明数据包在到达目的地途中将经过的各节点的地址列表。<br>
• 分片： 当IPv6源地址发送的数据包比到达目的地址所经过的路径上的最小MTU还要大时， 这个数据包就要被分成几段分别发送，这时就要用到分片头。<br>
• 鉴别： 鉴别头的功能是实现了数据的完整性和对数据来源的认证。<br>
• 封装安全有效载荷： 封装安全有效载荷头提供数据加密功能，实现端到端的加密， 提 供无连接的完整性和防重发服务。封装安全有效载荷头可以单独使用， 也可以在使用 隧道模式时嵌套使用。<br>
• 目的站选项： 目的站选项头中携带仅需要最终目的节点检验的可选信息。 它要在IPv6 目的地址域所列的第一个目的主机上处理，也要在路由头所列的后续目的主机上处理。</p>
<h3 id="IPv6-地址自动配置">IPv6 地址自动配置</h3>
<p>IPv6 中地址自动配置有两种方式： 有状态地址自动配置和无状态地址自动配置。当站点并<br>
不是特别关心主机所使用的精确地址时，只要它们是唯一的，井且是可路由的，就能使用无状<br>
态方式： 当站点严格控制地址分配时，就使用有状态方式。</p>
<p>(1）有状态地址自动配置。在这种模式下， 主机可以从服务器获得接口地址，也可以从服 务器上获得配置信息和参数。服务器中维护着一个数据库，其中记录着主机和地址分配的列表。 比较常用的是DHCPv6 (Dynamic Host Configuration Protocol for IPv6）协议， 即支持 IPv6 的动 态主机配置协议。它允许DHCPv6服务器把诸如IPv6 网络地址等信息传给1Pv6节点。DHCPv6 服务器与客户端使用UDP来交换DHCPv6报文。服务器和中继代理使用 UDP端口 547来监昕 DHCPv6 报文； 客户端使用 UDP端口 546来监听报文。</p>
<p>(2）无状态地址自动配置。这种模式要求本地链路支持组擂，而且网络接口能够发送和接 收组播包。 采用这种方式可以为任意主机配置一个IPv6地址，这个地址内嵌一个以太网地址， 由于以太网地址全球唯一，因此获得的IPv6地址也是唯一的。<br>
具体过程如下：<br>
首先，进行自动配置的节点必须确定自己的链路本地地址。<br>
然后，必须验证该链路本地地址在链路上的唯一性。<br>
最后，节点必须确定需要配置的信息。该信息可能是节点的 IP 地址，或者是其他配置信息， 或者两者皆有。<br>
具体地说， 在无状态地址自动配置过程中， 主机首先通过将它的网卡MAC地址附加在链 路本地地址前缀 1111111010 之后，产生一个链路本地单播地址 (IEEE 已经将网卡 MAC 地址 由 48 位改为了 64位。如果主机采用的网卡的MAC地址依然是48位，那么 IPv6 网卡驱动程序会根据IEEE 的一个公式将48位MAC地址转换为64位MAC地址） 。接着主机向该地址发出一个邻居发现请求（Neighbor Discovery Request），以验证地址的唯一性。 如果请求没有得到响应，则表明主机自我配置的链路本地单播地址是唯一的。否则， 主机将使用一个随机产生 的接口 ID 组成一个新的链路本地单播地址。然后，以该地址为源地址，主机向本地链路中所 有路由器多点传送一个路由器请求（Router Solicitation）来请求配置信息，路由器以一个包含一个可聚集全球单播地址前缀和其他相关配置信息的路由器宣告（Router Advertisement）作为响应。主机用它从路由器得到的全球地址前缀加上自己的接口 ID，自动配置全球地址，然后就可以与Internet 中的其他主机通信了。</p>
<p>如果本地网络孤立于其他网络，则节点必须寻找配置服务器来完成其配置：否则，节点必须侦听路由器宣告报文。这些报文周期性地发往所有主机的组播地址，以指明诸如网络地址和子网地址等配置信息。 节点可以等待路由器宣告，也可以通过发送组播请求给所有路由器的组播地址来请求路由器发送宣告。 一旦收到路由器的响应，节点就可以使用响应的信息来完成自动配置。</p>
<h3 id="邻节点发现过程">邻节点发现过程</h3>
<p>邻居发现协议使用一系列的 IPv6 控制信息报文来实现相邻节点的信息交互管理，井在一 个子网中保持网络层地址和链路层地址之间的映射。邻居发现协议中定义了 5种类型的信息： 路由器宣告、路由器请求、路由重定向、 邻居请求和邻居宣告。 邻节点发现过程具体如下：<br>
①路由器发现：即帮助主机来识别本地路由器。<br>
②前缀发现： 节点使用此机制来确定指明链路本地地址的地址前缀以及必须发送给路由 器转发的地址前缀。<br>
③参数发现： 帮助节点确定诸如本地链路MTU之类的信息。<br>
④地址自动配置： 用于IPv6节点自动配置。<br>
⑤地址解析： 替代了ARP和RARP， 帮助节点从目的IP地址中确定本地节点（即邻居） 的链路层地址。<br>
⑥下一跳确定： 可用于确定包的下一个目的地，即可确定包的目的地是否在本地链路上。 如果在本地链路，下一跳就是目的地；否则，包需要选路，下一跳就是路由器，邻居发现可用 于确定应使用的路由器。<br>
⑦邻居不可达检测： 帮助节点确定邻居（目的节点或路由器）是否可达。 ③ 重复地址检测： 帮助节点确定它想使用的地址在本地链路上是否己被占用。 ⑨重定向： 有时节点选择的转发路由器对于待转发的包而言并非最佳。 这种情况下，该 转发路由器可以对节点进行重定向， 使它将包发送给更佳的路由器。</p>
<h3 id="ICMP-协议">ICMP 协议</h3>
<p>ICMP (Internet Control Message Protocol) 与 IP 协议同属于网络层， 用于传送有关通信问 题的消息，例如数据报不能到达目标站，路由器没有足够的缓存空间， 或者路由器向发送主机 提供最短通路信息等。 ICMP报文封装在IP数据报中传送， 因而不保证可靠的提交。 ICMP报文有 11 种之多，报文格式如图所示。 其中， 类型字段表示ICMP报文的类型：代码字段可表示报文的少量参数： 当参数较多时写入32位的参数字段： ICMP报文携带的信息包含在可变长的信息字段中；校验和宇段是关于整个ICMP报文的校验和。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/ICMP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png" alt=""><br>
报文包括以下类型：<br>
• 目标不可到达(类型 3) ：如果路由器判断出不能把IP数据报送达目标主机，则向源主机返回这种报文。 另一种情况是目标主机找不到有关的用户协议或上层服务访问点，也会返回这种报文。 出现这种情况的原因可能是IP头中的字段不正确：或者是数据报中说明 的源路由无效：也可能是路由器必须把数据报分段，但IP头中的D标志己置位。<br>
• 超时（类型 11 ）：路由器发现 IP 数据报的生存期已超时，或者目标主机在一定时间内无法完成重装配，则向源端返回这种报文。<br>
• 源抑制（类型4) ： 这种报文提供了一种流量控制的初等方式。如果路由器或目标主机缓冲资源耗尽而必须丢弃数据报，则每丢弃一个数据报就向源主机发回一个源抑制报文，这时源主机必须减小发送速度。 另外一种情况是系统的缓冲区已用完， 并预感到行将发生拥塞，则发出源抑制报文。 但是与前一种情况不同，涉及的数据报尚能提 交给目标主机。<br>
• 参数问题（类型 12）：如果路由器或主机判断出 IP 头中的字段或语义出错，则返回这种报文，报文头中包含一个指向出错字段的指针。<br>
• 路由重定向（类型 5）：路由器向直接相连的主机发出这种报文，告诉主机一个更短的路径。 例如路由器R1 收到本地网络上主机发来的数据报， Rl检查它的路由表， 发 现要把数据报发往网络X，必须先转发给路由器R2，而R2又与源主机在同一网络中， 于是R1 向源主机发出路由重定向报文，把R2的地址告诉它。<br>
• 回声 （请求／响应，类型8/0） ： 用于测试两个节点之间的通信线路是否畅通。收到回声 请求的节点必须发出回声响应报文。该报文中的标识符和序列号用于匹配请求和响应报文。当连续发出回声请求时，序列号连续递增。 常用的PING工具就是这样工作的。<br>
• 时间戳（请求／响应， 类型 13/14）：用于测试两个节点之间的通信延迟时间。请求方发出本地的发送时间，响应方返回自己的接收时间和发送时间。 这种应答过程如果结合强制路由的数据报实现，则可以测量出指定线路上的通信延迟。<br>
• 地址掩码（请求／响应，类型 17/18）：主机可以利用这种报文获得它所在的LAN的子网掩码。 首先主机广播地址掩码请求报文，同一 LAN上的路由器以地址掩码响应报文回答，告诉请求方需要的子网掩码。了解子网掩码可以判断出数据报的目标节点与源节点是否在同一LAN中</p>
<h3 id="ARP-协议">ARP 协议</h3>
<p>IP 地址是分配给主机的逻辑地址，在因特网络中表示唯一的主机。 似乎有了 IP地址就可以方便地访问某个子网中的某个主机，寻址问题就解决了。其实不然，还必须考虑主机的物理地址问题。<br>
由于互连的各个子网可能源于不同的组织，运行不同的协议（异构性），因而可能采用不同的编址方法。任何子网中的主机至少都有一个在子网内部唯一的地址，这种地址都是在子网建立时一次性指定的， 甚至可能是与网络硬件相关的，我们把这个地址叫作主机的物理地址或 硬件地址。<br>
物理地址和逻辑地址的区别可以从两个角度看：从网络互连的角度看，逻辑地址在整个因特网络中有效，而物理地址只是在子网内部有效；从网络协议分层的角度看，逻辑地址由 Internet 层使用，而物理地址由子网访问子层（具体地说就是数据链路层）使用。 由于有两种主机地址， 因此需要一种映像关系把这两种地址对应起来。在 Internet 中是用地址分解协议（Address Resolution Protocol, ARP ） 来实现逻辑地址到物理地址映像的。</p>
<h3 id="ARP-分组格式">ARP 分组格式</h3>
<p>ARP 分组的格式如图所示，各字段的含义解释如下。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/ARP%E5%8F%8DARP%E5%88%86%E7%BB%84%E6%A0%BC%E5%BC%8F.png" alt=""><br>
• 硬件类型： 网络接口硬件的类型，对以太网此值为 1。<br>
•协议类型： 发送方使用的协议， 0800H表示IP协议。<br>
•硬件地址长度： 对以太网，地址长度为6字节。<br>
•协议地址长度： 对IP协议，地址长度为4字节。</p>
<p>操作：<br>
1 ARP 请求<br>
2 ARP 响应<br>
3 RARP 请求<br>
4 RARP 响应<br>
通常， Internet 应用程序把要发送的报文交给 IP, IP 协议当然知道接收方的逻辑地址（否则就不能通信了） ， 但不一定知道接收方的物理地址。在把IP分组向下传送给本地数据链路实体之前，可以用两种方法得到目标物理地址。<br>
(1)查本地内存的 ARP地址映像表，通常ARP地址映像表的逻辑结构如表所示。可以看出这是IP地址和以太网地址的对照表。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/ARP%E5%9C%B0%E5%9D%80%E6%98%A0%E5%83%8F%E8%A1%A8%E7%9A%84%E4%BE%8B%E5%AD%90.png" alt=""></p>
<p>( 2）如果ARP表查不到，就广播一个ARP请求分组， 这种分组可经过路由器进一步转发， 到达所有连网的主机。它的含义是： “如果你的IP地址是这个分组的目标地址，请回答你的物理地址是什么。 ”收到该分组的主机一方面可以用分组中的两个源地址更新自己的ARP地址映像表： 另一方面用自己的IP地址与目标IP地址宇段比较， 若相符则发回一个ARP响应分组， 向发送方报告自己的硬件地址， 若不相符则不予回答。</p>
<h3 id="代理ARP">代理ARP</h3>
<p>所谓代理ARP (Proxy ARP） ， 就是路由器“假装”目标主机来回答ARP请求， 所以源主机必须先把数据帧发给路由器，再由路由器转发给目标主机。这种技术不需要配置默认网关， 也不需要配置路由信息，就可以实现子网之间的通信。用于说明代理ARP的例子如图所示， 设子网A上的主机A (172.16.10.100）需要与子网B上的主机D (172.16.20.200）通信。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E4%BB%A3%E7%90%86ARP%E7%9A%84%E4%BE%8B%E5%AD%90.png" alt=""><br>
图中的主机A有一个16位的子网掩码，这意味着主机A认为它直接连接到网络172.16.0.0。 当主机A需要与它直接连接的设备通信时，它就向目标发送一个ARP请求。 当主机A需要主机D的MAC地址时， 它在子网A上广播的ARP请求分组如下<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/ARP%E8%AF%B7%E6%B1%82%E5%88%86%E7%BB%84.png" alt=""><br>
这个请求的含义是要求主机D (172.16.20.200） 回答它的 MAC 地址。 ARP 请求分组被包装在以太帧中，其源地址是A的MAC地址，而目标地址是广播地址 （FFFF.FFFF.FFFF） 。 由于路由器不转发广播帧，所以这个ARP请求只能在子网A中传播，到不了主机D。如果路由器知道目标地址（172.16.20.200）在另外一个子网中，它就以自己的 MAC 地址回答主机 A,路由器发送的应答分组如下。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/ARP%E5%BA%94%E7%AD%94%E5%88%86%E7%BB%84.png" alt=""><br>
这个应答分组封装在以太帧中， 以路由器的MAC地址为源地址， 以主机A的MAC地址为目标地址， ARP应答帧是单播传送的。在接收到ARP应答后，主机A就将它的ARP表更新如下。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/ARP%E8%A1%A8%E6%9B%B4%E6%96%B0.png" alt=""></p>
<p>从此以后，主机A就把所有给主机D(172.16.20.200）的分组发送给MAC地址为 00-00-0c-94-36-ab 的主机， 这就是路由器的网卡地址。 通过这种方式，子网A中的ARP映像表都把路由器的MAC地址当作子网B中主机的MAC 地址。 例如，主机A的ARP映像表如下。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E6%98%A0%E5%83%8F%E8%A1%A8.png" alt=""><br>
多个IP地址被映像到一个MAC地址这一事实正是代理ARP的标志。<br>
RARP (Reverse Address Resolution Protocol）是反向 ARP 协议，即由硬件地址查找逻辑地址。 通常， 主机的E地址保存在硬盘上，机器关电时也不会丢失，系统启动时自动读入内存中。但是， 无盘工作站无法保存E地址， 它的E地址由RARP服务器保存。当无盘工作站启动时， 广播一个 RARP请求分组，把自己的硬件地址同时写入发送方和接收方的硬件地址字段中。 RARP服务器接 收这个请求，并填写目标IP地址字段，把操作字段改为RARP响应分组，送回请求的主机。</p>
<h3 id="路由协议">路由协议</h3>
<p>因特网由不同的自治系统互连而成。自治系统内采用内部网关协议（Interior Gateway Protocol, IGP）进行路由选择，可能选择不同的路由表、 不同的路由选择算法。在不同自治系统之间用外部网关协议（Exterior Gateway Protocol, EGP）交换路由信息。 例如若干个校园网 通过广域网互连就是这种情况，如图所示。常用内部路由协议包括路由信息协议（Routing Information Protocol, RIP）、开放最短路径优先协议（Open Shortest Path First, OSPF）、中间系统到中间系统的协议 (IntermediateSystem to Intermediate System, IS-IS）、内部网关路由协 议（Interior Gateway Routing Protocol, IGRP）和增强的 IGRP 协议 （Enhanced IGRP, EIGRP）。 外部网关协议有BGP协议。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE%E5%92%8C%E5%A4%96%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE.png" alt=""></p>
<h3 id="路由信息协议（RIP">路由信息协议（RIP)</h3>
<p>RIP 是一种分布式的基于距离向量的路由选择协议。 该协议定义距离就是经过的路由器的数目， 距离最短的路由就是最好的路由。它允许一条路径最多只能包含 15 个路由器（限制了 网络的规模） 。 距离的最大值为 16 时即为不可达。 所以RIP 不能在两个网络之间同时使用多 条路由来进行负载均衡。<br>
RIP 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记 录，并依此来形成自己的路由表， 且按固定时间（一般为30s）和相邻路由器交换路由表。<br>
RIP 协议属于应用层协议，它使用传输层的用户数据报 UDP 进行传送。 RIP协议的格式 及它和UDP, IP协议的关系如图所示。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/RIP%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8F%8A%E5%AE%83%E5%92%8CUDP,IP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt=""><br>
RIP协议中的命令字段指出报文的意义。 地址类别字段指出所使用的地址协议， 当使用IP 地址时， 该字段的值为 2。 路由标记字段应该写入自治系统号。 一个RIP报文最大长度为 504 字节， 这是因为一个RIP报文的路由部分最多可包含25个路由信息。当超过504字节的最大长度时， 就应该再用一个RIP报文来传送。 RIP 的特点是： “好消息传播得快， 坏消息传播得慢。 ”它的意思是， 如果路由器发现了一个 更短的路由，这个消息可以很快得以传播； 但如果网络出现了故障， 这样的消息会传播得很慢。</p>
<h3 id="开放最短路径优先协议（OSPF">开放最短路径优先协议（OSPF)</h3>
<p>OSPF 协议是分布式的链路状态路由协议。链路在这里代表该路由器和哪些路由器是相邻 的， 即通过一个网络是可以连通的;链路状态说明了该通路的连通状态以及距离、时延、带宽等参数。在该协议中， 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送路由信息。 所发送的信息是与本路由器相邻的所有路由器的链路状态。为了保存这些链路状态信息， 每个路由器都会建立一个链路状态数据库， 因为路由器交换信息时使用的是洪泛法，所以每个路由器都存有全网的链路状态信息，也就是说每个路由器都知道整个网络的连通情况和拓扑结构。这样每个路由器都可以根据链路状态数据库的信息来构造自己的路由表。 为了及时了解链路的状态情况， 每个路由器需要定期（10s）向邻居路由器发送Hello分组。 如果40秒钟还没有收到邻居的Hello信息，则认为该邻居是不连通的，应该立即修改链路状态数据库中所对应的记录，并重新计算路由表。 除了 Hello 问候分组外， OSPF 协议还有四种分组： 链路状态更新分组、 链路状态确认分组、 链路状态描述分组和链路状态请求分组。 通过这四种分组达到全网链路数据库的同步。 链路状态更新分组是正常情况下， 当链路状态发生变化时使用洪泛法所发送的分组： 链路状态确认分组是对链路状态更新分组的确认： 链路状态描述分组是当路由器启动一条新的通路时，向邻居路由器所发送的分组： 链路状态请求分组是在与邻居路由器交换了链路状态描述分组后， 还需要其他自己缺少的路由信息时所使用的分组。 OSPF 协议的格式及它与IP协议的关系如图所示。<br>
<img src="" alt=""><br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/OSPF%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8F%8A%E5%AE%83%E4%B8%8EIP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt=""><br>
OSPF 协议使用洪泛法向网络中所有路由器发送链路状态信息，为了减小洪泛范围， OSPF 协议对网络进行了区域划分。 这在OSPF协议首部的区域标识符宇段体现了出来</p>
<h3 id="IS-IS-路由协议">IS-IS 路由协议</h3>
<p>IS-IS (Intermediate System to Intermediate System，中间系统到中间系统）路由协议最初是 ISO （国际标准化组织）为 CLNP ( Connection Less Network Protocol， 无连接网络协议）设计的一种动态路由协议。为了提供对IP路由的支持， 通过对IS-IS进行扩充和修改，使IS-IS 能够同时应用在TCP/IP环境中，形成了集成化IS-IS， 用于城域网和承载网中。 IS-IS 协议也是基于链路状态并使用最短路径优先算法进行路由计算的一种 IGP 协议。 OSPF 具有多路由类型、 多区域类型、根据带宽设定开销规则、 网络类型多样等特点，多用 园区网中。 IS-IS 则具有算法快速、报文结构简便、 快速建立邻居关系以及大容量路由传递等一 系列特点，在骨干网有着天然的优势</p>
<p>1.路由器类型<br>
在IS-IS 中，路由器可以分为三种类型：Level-1(L1）路由器、Level-2(L2）路由器、Level-1-2 ( L1/2 ）路由器。<br>
( 1) Level-1 路由器， 特点如下：<br>
• L1 路由器是一个IS-IS普通区域内部的路由器， 只能在非骨干区域中存在。<br>
• L1 路由器只能与属于同一区域的L1 和L1/2 路由器建立L1 邻接关系（不能与L2路由器建立邻接关系） ， 交换路由信息， 并维护和管理本区域内部的一个L2 的LSDB。<br>
• L1 路由器的邻居都在同一个区域中， 其 LSDB 包含本区域的路由信息以及到达同一 区域中最近Ll/2 路由器（相当于 OSPF 中的 ABR）的缺省路由， 但到区域外的数据 需由最近的Ll/2 路由器进行转发。<br>
• 也就是说， L1 路由器只能转发区域内的报文， 或者将到达其他区域的报文转发到距离 它最近，且在同一区域的L1/2路由器。</p>
<p>(2) Level-2 路由器， 特点如下：<br>
•L2 路由器是骨干区域中的路由器，主要用于通过与普通区域中的L1/2 路由器连接，连接骨干区域和非骨干区域， 类似于OSPF网络中的BR （骨干路由器，并负责在不同区域间的通信。 L2路由器负责区域间的路由，它可以与相同或者不同区域的L2路由器或者不同区域的Ll/2路由器形成邻居关系。 L2路由器维护一个L2 的LSDB，该 LSDB 包含区域间的路由信息。 L2路由器只可能建立L2 的邻接关系。<br>
•网络中的所有口路由器和所有L1/2路由器连接在一起共同构成IS-IS 网络的骨干网 （注意，不是骨干区域）， 也称L2区域。 IS-IS 中的L2 区域不是一个特定的区域，是 由连接网络中各个区域的一部分路由器组成的， 但必须是连续的。</p>
<p>(3) Level-1-2 路由器，特点如下：<br>
•L1/2 路由器类似于OSPF 网络中的ABR C区域边界路由器〉，用于区域间的连接。<br>
•L1/2 路由器既可以与同一普通区域的L1 路由器以及其他L1/2路由器建立L1 邻接关 系，也可以与骨干区域L2路由器建立L2邻接关系。 L1 路由器必须通过L1/2路由器才能与其他区域通信。<br>
•L1/2 路由器必须维护以下两个LSDB: L1 LSDB 用于区域内路由， L2 LSDB用于区域间路由。 但要注意的是， L1/2路由器不一定要位于区域边界，在区域内部也有可能存在L1/2 路由器</p>
<p>网络分层路由域为了支持大规模的路由网络， IS-IS 在自治系统内采用骨干区域与非骨干区域两级分层结构，如图所示。一般来说，将Level-1路由器部署在非骨干区域，将Level-2路由器和Level-1-2 路由器部署在骨干区域。每一个非骨干区域都通过Level-1-2路由器与骨干区域相连。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/IS-IS%E5%88%86%E5%B1%82%E8%B7%AF%E7%94%B1%E7%BB%93%E6%9E%84.png" alt=""></p>
<p>在OSPF 中， 骨干区域固定为Area0， 且非骨干区域要和骨干区域相连（没有通过物理连 接的话则要进行虚连接）。但是在IS-IS 中：<br>
• 可以有多个骨干区域，且区域ID不固定；<br>
• 非骨干区域必须和骨干区域物理相连（通过L1/2路由器)： 非骨干区域之间不能直接连接。 Level-1-2 级别的路由器可以属于不同的区域，在 Level-1区域维护Level-1的 LSDB， 在 Level-2 区域维护 Level-2 的 LSDB。<br>
外部网关协议（BGP) BGP 是不同自治系统的路由器之间交换路由信息的协议。由于Internet的规模太大，使得自治系统之间路由选择非常困难。 另外， 对于自治系统之间的路由选择，要寻找最佳路由是不现实的。 所以 BGP 只是尽力寻找一条能够到达目的网络且比较好的路由（不能兜圈子） ，而不像内部网关协议一样要寻找一条最佳路由。</p>
<p>每一个自治系统的管理员要选择至少一个路由器作为该自治系统的“BGP 发言人”。 BGP 发言人往往就是 BGP 边界路由器， 但也可以不是 BGP 边界路由器。 通常，两个 BGP 发言 人都是通过一个共享网络连接在）起的。<br>
当一个 BGP 发言人与其他自治系统中的 BGP 发言人交换路由信息时， 首先要建立 TCP 连接，然后在此连接上交换 BGP 报文以建立 BGP 会话（session），利用 BGP 会话 交换路由信息。<br>
在BGP 刚刚运行时， BGP 的邻站是交换整个的 BGP 路由表。但以后只需要在发生变化 时更新有变化的部分。 这样做对节省网络带宽和减少路由器的处理开销方面都有好处。 BGP 发言人互相交换网络可达性的信息后，各 BGP 发言人就可找出到达各自治系统的比 较好的路由。</p>
<p>BGP-4 共使用四种报文：<br>
• 打开（Open）报文，用来与相邻的另一个BGP发言人建立关系。<br>
• 更新（Update）报文，用来发送某一路由的信息， 以及列出要撤销的多条路由。<br>
• 保活（Keepalive）报文，用来确认打开报文和周期性地证实邻站关系。<br>
• 通知（Notification）报文，用来发送检测到的差错。<br>
BGP 协议的格式及它与TCP和IP协议的关系如图所示。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/BGP%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8F%8A%E5%AE%83%E4%B8%8ETCP%E5%92%8CIP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt=""></p>
<h3 id="核心网关协议">核心网关协议</h3>
<p>Internet 中有一个主干网，所有的自治系统都连接到主干网上。 这样， Internet 的总体结构 如图所示，分为主干网和外围部分， 后者包含所有的自治系统。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/Internet%E7%9A%84%E6%80%BB%E4%BD%93%E7%BB%93%E6%9E%84.png" alt=""><br>
主干网中的网关叫核心网关。核心网关之间交换路由信息时使用核心网关协议（Gatewayto Gateway Protocol, GGP)。 这里要区分 EGP 和 GGP, EGP 用于两个不同自治系统之间的网关 交换路由信息，而GGP是主干网中的网关协议。 因为主干网中的核心网关是由InterNOC直接控制的， 所以GGP更具有专用性。 当一个核心网关加入主干网时用GGP协议向邻机广播发送 路由信息，各邻机更新路由表，并进一步传播新的路由信息。<br>
网关交换的路由信息与 EGP 协议类似，指明网关连接哪些网络， 距离是多少，距离也是 以中间网关个数计数。 GGP协议的报文格式与EGP类似，报文分为以下4类：<br>
• 路由更新报文： 发送路由信息。<br>
• 应答报文： 对路由更新报文的应答，分肯定、否定两种。<br>
• 测试报文： 测试相邻网关是否存在。<br>
• 网络接口状态报文：测试本地网络连接的状态。</p>
<h3 id="路由器技术">路由器技术</h3>
<h3 id="NAT-技术">NAT 技术</h3>
<p>NAT 技术主要解决 IP 地址短缺问题，最初提出的建议是在子网内部使用局部地址，而在 子网外部使用少量的全局地址，通过路由器进行内部和外部地址的转换。局部地址是在子网内部独立编址的，可以与外部地址重叠。 这种想法的基础是，假定在任何时候，子网中只有少数计算机需要与外部通信，可以让这些计算机共享少量的全局IP地址。后来根据这种技术叉开发 出其他一些应用，下面介绍两种最主要的应用。</p>
<p>第一种应用是动态地址翻译（Dynamic Address Translation）。为此首先引入存根域（Stub Domain）的概念。所谓存根域，就是内部网络的抽象，这样的网络只处理源和目标都在子网内部的通信。任何时候，存根域内只有一部分主机要与外界通信，甚至还有许多主机可能从不与外界通信，所以整个存根域只需共享少量的全局IP地址。 存根域有一个边界路由器，由它来处理域内主机与外部网络的通信。 在此做以下假定：<br>
m： 需要翻译的内部地址数。<br>
n：可用的全局地址数（NAT地址）<br>
当 m:n 翻译满足条件（m1且 mn） 时，可以把一个大的地址空间映像到一个小的地址空间。所有NAT地址放在二个缓冲区中，并在存根域的边界路由器中建立一个局部地址和全局地址的动态映像表，如图所示。 这个图显示的是把所有B类网络 138.201.0.0 中的IP地 址翻译成C类网络 178.201.112.0 中的 IP 地址。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E5%8A%A8%E6%80%81%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E7%BF%BB%E8%AF%91.png" alt=""><br>
这种NAT地址重用有以下特点：<br>
• 只要缓冲区中存在尚未使用的C类地址，任何从内向外的连接请求都可以得到响应， 并且在边界路由器的动态NAT表为之建立一个映像表项。<br>
• 如果内部主机的映像存在，可以利用它建立连接。<br>
• 从外部访问内部主机是有条件的，即动态NAT表中必须存在该主机的映像。动态地址翻译的好处是节约了全局 IP 地址，而且不需要改变子网内部的任何配置， 只需在边界路由器中设置一个动态地址变换表就可以工作了。</p>
<p>另外一种特殊的NAT应用是m:1翻译，这种技术也叫作伪装 （Masquerading） ， 因为 用一个路由器的IP地址可以把子网中所有主机的IP地址都隐藏起来。 如果子网中有多个主机 同时都要通信，那么还要对端口号进行翻译，所以这种技术经常被称为网络地址和端口翻译 ( Network Address Port Translation, NAPT)。在很多 NAPT 实现中专门保留一部分端口号给伪装使用，叫作伪装端口号。图中的NAT路由器中有一个伪装表，通过这个表对端口号进行翻译，从而隐藏了内部网络 138.201.0.0 中的所有主机。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/JYHE.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/JYHE.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">JYhe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/')">网规基础9网络层协议</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=网规基础9网络层协议&amp;url=http://example.com/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/&amp;pic=/img/default_cover.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络规划设计师<span class="tagsPageCount">9</span></a><a class="post-meta__box__tags" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>基础知识<span class="tagsPageCount">9</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%808%E7%BD%91%E7%BB%9C%E4%BA%92%E8%BF%9E%E4%B8%8E%E4%BA%92%E8%81%94%E7%BD%91/"><img class="prev-cover" src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">网规基础8网络互连与互联网</div></div></a></div><div class="next-post pull-right"><a href="/2025/12/12/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/"><img class="next-cover" src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info"></div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/10/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%801%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/" title="1计算机网络历史组成"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-27</div><div class="title">1计算机网络历史组成</div></div></a></div><div><a href="/2025/10/29/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%802%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E6%A6%82%E5%BF%B5/" title="2数据通讯概念"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-29</div><div class="title">2数据通讯概念</div></div></a></div><div><a href="/2025/10/30/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%803%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%EF%BC%8C%E8%B0%83%E5%88%B6%E6%8A%80%E6%9C%AF%E4%B8%8E%E9%80%9A%E4%BF%A1%E9%A2%86%E5%9F%9F/" title="3数据编码，调制技术与通信领域"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-30</div><div class="title">3数据编码，调制技术与通信领域</div></div></a></div><div><a href="/2025/11/05/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%805%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/" title="网规基础5无线通信网络"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-11-05</div><div class="title">网规基础5无线通信网络</div></div></a></div><div><a href="/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/" title="网规基础4局域网，广域网"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-11-02</div><div class="title">网规基础4局域网，广域网</div></div></a></div><div><a href="/2025/11/19/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%806%E6%97%A0%E7%BA%BF%E4%B8%AA%E4%BA%BA%E7%BD%91/" title="网规基础6无线个人网"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-11-19</div><div class="title">网规基础6无线个人网</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="/img/JYHE.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">IP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83"><span class="toc-number">1.1.</span> <span class="toc-text">IP 协议数据单元</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86"><span class="toc-number">1.2.</span> <span class="toc-text">IP 地址与子网划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.</span> <span class="toc-text">IPv6 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6-%E5%9C%B0%E5%9D%80%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">IPv6 地址自动配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%BB%E8%8A%82%E7%82%B9%E5%8F%91%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">邻节点发现过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.6.</span> <span class="toc-text">ICMP 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.7.</span> <span class="toc-text">ARP 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARP-%E5%88%86%E7%BB%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">ARP 分组格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86ARP"><span class="toc-number">1.9.</span> <span class="toc-text">代理ARP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.10.</span> <span class="toc-text">路由协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AE%EF%BC%88RIP"><span class="toc-number">1.11.</span> <span class="toc-text">路由信息协议（RIP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E5%8D%8F%E8%AE%AE%EF%BC%88OSPF"><span class="toc-number">1.12.</span> <span class="toc-text">开放最短路径优先协议（OSPF)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IS-IS-%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.13.</span> <span class="toc-text">IS-IS 路由协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.14.</span> <span class="toc-text">核心网关协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E6%8A%80%E6%9C%AF"><span class="toc-number">1.15.</span> <span class="toc-text">路由器技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAT-%E6%8A%80%E6%9C%AF"><span class="toc-number">1.16.</span> <span class="toc-text">NAT 技术</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/12/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" title="No title"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/2025/12/12/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" title="No title">No title</a><time datetime="2025-12-12T04:07:55.271Z" title="Created 2025-12-12 12:07:55">2025-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/" title="网规基础9网络层协议"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础9网络层协议"/></a><div class="content"><a class="title" href="/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%809%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE/" title="网规基础9网络层协议">网规基础9网络层协议</a><time datetime="2025-11-27T05:42:00.000Z" title="Created 2025-11-27 13:42:00">2025-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%808%E7%BD%91%E7%BB%9C%E4%BA%92%E8%BF%9E%E4%B8%8E%E4%BA%92%E8%81%94%E7%BD%91/" title="网规基础8网络互连与互联网"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础8网络互连与互联网"/></a><div class="content"><a class="title" href="/2025/11/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%808%E7%BD%91%E7%BB%9C%E4%BA%92%E8%BF%9E%E4%B8%8E%E4%BA%92%E8%81%94%E7%BD%91/" title="网规基础8网络互连与互联网">网规基础8网络互连与互联网</a><time datetime="2025-11-27T05:42:00.000Z" title="Created 2025-11-27 13:42:00">2025-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/26/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%807%E7%A7%BB%E5%8A%A8%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/" title="网规基础7移动通信网络"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础7移动通信网络"/></a><div class="content"><a class="title" href="/2025/11/26/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%807%E7%A7%BB%E5%8A%A8%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/" title="网规基础7移动通信网络">网规基础7移动通信网络</a><time datetime="2025-11-26T02:46:00.000Z" title="Created 2025-11-26 10:46:00">2025-11-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/19/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%806%E6%97%A0%E7%BA%BF%E4%B8%AA%E4%BA%BA%E7%BD%91/" title="网规基础6无线个人网"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础6无线个人网"/></a><div class="content"><a class="title" href="/2025/11/19/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%806%E6%97%A0%E7%BA%BF%E4%B8%AA%E4%BA%BA%E7%BD%91/" title="网规基础6无线个人网">网规基础6无线个人网</a><time datetime="2025-11-19T11:22:37.783Z" title="Created 2025-11-19 19:22:37">2025-11-19</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="JYhe" target="_blank">JYhe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">1</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>9</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" style="font-size: 0.88rem;">网络规划设计师<sup>9</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;undefined&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("27/10/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 JYhe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>