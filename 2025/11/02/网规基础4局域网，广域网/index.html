<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>网规基础4局域网，广域网 | JYhe</title><meta name="keywords" content="网络规划设计师,基础知识"><meta name="author" content="JYhe"><meta name="copyright" content="JYhe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="网规基础4局域网，广域网"><meta name="application-name" content="网规基础4局域网，广域网"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="网规基础4局域网，广域网"><meta property="og:url" content="http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/index.html"><meta property="og:site_name" content="JYhe"><meta property="og:description" content="局域网 HDLC协议 HDLC(HighLevelDataLinkControl，高级数据链路控制)协议是国际标准化组织根据IBM公司的SDLC(SynchronousDataLinkControl，同步数据链路控制)协议扩充开发而成的。美国国家标准学会(ANSI)则根据SDLC开发出类似的协议，叫"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/img/default_cover.jpg"><meta property="article:author" content="JYhe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/default_cover.jpg"><meta name="description" content="局域网 HDLC协议 HDLC(HighLevelDataLinkControl，高级数据链路控制)协议是国际标准化组织根据IBM公司的SDLC(SynchronousDataLinkControl，同步数据链路控制)协议扩充开发而成的。美国国家标准学会(ANSI)则根据SDLC开发出类似的协议，叫"><link rel="shortcut icon" href="/img/JYHE.jpg"><link rel="canonical" href="http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: JYhe","link":"Link: ","source":"Source: JYhe","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'JYhe',
  title: '网规基础4局域网，广域网',
  postAI: '',
  pageFillDescription: '局域网, HDLC协议, 1.HDLC的基本配置, 2.HDLC的帧结构, IEEE802.3标准, CSMA/CD协议, 二进制指数后退算法, 局域网互连, 高速以太网, 虚拟局域网, 冗余网关技术, VRRP, HSRP, GLBP, VRRP主备备份配置示例, 以太环网保护技术, 弹性分组环, 公平算法原理, 拓扑发现原理, 保护原理, 以太网环保护交换, 城域网局域网协议高级数据链路控制协议是国际标准化组织根据公司的同步数据链路控制协议扩充开发而成的美国国家标准学会则根据开发出类似的协议叫作协高级数据通信控制协议的基本配置定义了种类型的站两种链路配置和种数据传输方式种站分别如下主站对链路进行控制主站发出的帧叫命令帧从站在主站控制下进行操作从站发出的帧叫响应帧复合站具有主站和从站的双重功能复合站既可以发送命令帧也可以发出响应帧两种链路配置如下不平衡配置适用于点对点和点对多点链路这种链路由一个主站和一个或多个从站组成支持全双工或半双工传输平衡配置仅用于点对点链路这种配置由两个复合站组成支持全双工或半双工传输种数据传输方式如下正常响应方式适用于不平衡配置只有主站能启动数据传输过程从站收到主站的询问命令时才能发送数据异步平衡方式适用于平衡配置任何一个复合站都无须取得另一个复合站的允许就可以启动数据传输过程异步响应方式适用于不平衡配置从站无须取得主站的明确指示就可以启动数据传输主站的责任只是对线路进行管理正常响应方式可用于计算机和多个终端相连的多点线路上计算机对各个终端进行轮询以实现数据输入正常响应方式也可以用于点对点的链路上例如计算机和一个外设相连的情况异步平衡方式能有效地利用点对点全双工链路的带宽因为这种方式没有轮询的开销异步响应方式的特点是各个从站轮流询问中心站这种传输方式很少使用的帧结构使用统一的帧结构进行同步传输图所示为的帧结构从图中可以看出帧由个字段组成以两端的标志字段作为帧的边界在信息字段中包含了要传输的数据下面对帧的各个字段分别予以解释帧标志用一种特殊的位模式作为帧的边界标志链路上所有的站都在不断地探索标志模式一旦得到一个标志就开始接收帧在接收帧的过程中如果发现一个标志则认为该帧结束了由于帧中间出现位模式时也会被当作标志从而破坏了帧的同步所以要使用位填充技术发送站的数据位序列中一旦发现后有个则在第位插入一个这样就保证了传输的数据中不会出现与帧标志相同的位模式接收站则进行相反的操作在接收的位序列中如果发现后有个则检查第位若第位为则删除若第位是且第位是则认为是检测到帧尾的标志若第位和第位都是则认为是发送站的停止信号有了位填充技术任意的位模式都可以出现在数据帧中这个特点叫作透明的数据传输地址字段地址字段用于标识从站的地址用在点对多点链路中地址通常是位长然而经过协商之后也可以采用更长的扩展地址扩展的地址字段如图所示可以看出它是位组的整数倍每一个位组的最低位表示该位组是否是地址宇段的结尾若为表示是最后的位组若为则不是所有位组的其余位组成了整个扩展地址字段全为的位组表示广播地址控制字段定义了种帧可根据控制宇段的格式区分信息帧帧承载着要传送的数据此外还捎带着流量控制和差错控制的应答信号管理帧帧用于提供控制信息当不使用捎带机制时要用管理帧控制传输过程无编号帧帧提供建立释放等链路控制功能以及少量信息的无连接传送功能控制字段第位或前两位用于区别种不同格式的帧如图所示基本的控制字段是位长扩展的控制字段为位长信息字段剧只有帧和某些无编号帧含有信息宇段这个字段可含有用于表示用户数据的任何序列其长度没有规定但具体的实现往往限定了最大帧长帧校验序列中含有各个字段的校验标志字段除外通常使用标准产生位校验序列有时也使用产生位校验序列的帧类型协议的帧类型如表所示下面结合的操作介绍这些帧的作用信息帧信息帧除承载用户数据之外还包含该帧的编号韵以及捎带的肯定应答顺序号帧还包含一个位在主站发出的命令帧中这一位表示轮询在从站发出的响应帧中这一位是位即终止位在正常响应方式下主站发出的格式命令帧中的位置表示该帧是询问帧允许从站发送数据从站响应主站的询问可以发送多个响应帧其中仅最后一个响应帧的位置表示一批数据发送完毕在异步响应方式和异步平衡方式下位用于控制帧和帧的交换过程管理帧管理帧用于进行流量和差错控制当没有足够多的信息帧捎带管理命令响应时要发送专门的管理帧来实现控制从表看出有种管理帧可以用控制字段中的两个位来区分帧表示接收就绪它既是对之前帧的确认也是准备接收及其后续帧的肯定应答时帧表示接收未就绪在对之前的帧给予肯定应答的同时拒绝进一步接收后续帧帧表示拒绝接收帧要求重发帧及其后续帧显然用于后退帧流控方案中类似地帧用于选择重发流控方案中管理帧中位的作用如下所述主站发送位置的阻帧询问从站是否有数据要发送如果从站有数据要发送则以信息帧响应否则从站以位置的阻帧响应表示没有数据可发送另外主站也可以发送位置的帧询问从站的状态如果从站可以接收信息帧则以位置的阻帧响应反之如果从站忙则以位置的帧响应无编号帧无编号帧用于链路控制这类帧不包含编号字段也不改变信息帧流动的顺序无编号帧按其控制功能可分为以下几个子类设置数据传输方式的命令和响应帧传输信息的命令和响应帧用于链路恢复的命令和响应帧其它命令和相应帧设置数据传输方式的命令由主站发送给从站表示设置或改变数据传输方式和分别对应种数据传输方式和也是设置数据传输方式的命令帧然而这种传输方式使用两个字节的控制域从站接收了设置传输方式的命令帧后以无编号应答帧响应一种传输方式建立后一直保持有效直到另外的设置方式命令改变了当前的传输方式主站向从站发送置初始化方式命令使得接收该命令的从站启动一个建立链路的过程在初始化方式下两个站用无编号信息帧交换数据和命令拆除连接命令用于通知对方链路已经释放对方站以帧响应链路随之断开除帧之外还有儿种响应帧与传输方式的设置有关非连接方式帧可用于晌应所有的置传输方式命令表示响应的站处于逻辑上断开的状态即拒绝建立指定的传输方式请求初始化方式帧也可用于响应置传输方式命令表示响应站没有准备好接收命令或正在进行初始化请求拆除连接帧则表示响应站要求断开逻辑连接信息传输的命令和响应用于两个站之间交换信息无编号信息帧既可作为命令帧也可作为响应帧帧传送的信息可以是高层的状态操作中断状态时间链路初始化参数等主站复合站可发送无编号询问命令请求接收站送回无编号响应帧以了解它的状态链路恢复命令和响应用于机制不能正常工作的情况下接收站可用帧拒绝响应表示接收的帧中有错误例如控制宇段无效信息字段太长帧类型不允许携带信息以及捎带的无效等复位命令表示发送站正在重新设置发送顺序号这时接收站也应该重新设置接收顺序号还有两种命令和响应不能归入以上几类交换标识帧用于在两个站之间交换它们的标识和特征实际交换的信息依赖于具体的实现测试命令帧用于测试链路和接收站是否正常工作接收站收到测试命令后要尽快以测试帧响应的操作下面通过图的例子说明的操作过程这些例子虽然不能囊括实际运作中的所有情况但是可以帮助读者理解各种命令和响应的使用方法由于定义的命令和响应非常多可以实现各种应用环境的所有要求所以对于任何一种特定的应用只要实现一个子集就可以了以下给出的例子都是实际应用中的典型情况在图中用表示信息帧后面的两个数字分别表示信息帧中的和值管理帧和无编号帧都直接给出帧名字管理帧后的数字则表示帧中的值和表示该帧中的位置没有和表示这一位置图说明了链路建立和拆除的过程站发出命令井启动定时器在一定的时间内没有得到应答后重发同一命令站以帧响应并对本站的局部变量和计数器进行初始化站收到应答后也对本站的局部变量和计数器进行初始化并停止计时这时逻辑链路就建立起来了拆除链路的过程由双方交换一对命令和响应完成在实际使用中可能出现链路不能建立的情况站以响应站的命令或者站重复发送命令预定的次数后放弃建立连接向上层实体报告链接失败图说明了全双工交换信息帧的过程每个信息帧中用指明发送顺序号用指明接收顺序号当一个站连续发送了若干帧而没有收到对方发来的信息帧时字段只能简单地重复例如发给的和最后站没有信息帧要发时用一个管理帧对站给予应答图中也表示出了肯定应答的积累效应例如站发出的帧一次应答了站的两个数据帧图画出了接收站忙的情况出现这种情况的原因可能是接收站数据链路层缓冲区溢出也可能是接收站上层实体来不及处理接收到的数据图中站以响应站的帧表示站对第帧之前的帧己正确接收但不能继续接收下一个帧站接收到后每隔一定时间以位置的命令询问接收站的状态接收站如果保持忙则以位置的帧响应如果忙状态解除则以位置的帧响应于是数据传送从应答中的接收序号恢复发送图描述了使用命令的例子站发出了第信息帧其中第帧出错接收站检出错误帧后发出命令发送站返回到出错帧重发这是使用后退帧技术的典型情况图表示的是超时重发的例子站发出的第帧出错站检测到错误后丢弃了它但是站不能发出命令因为站无法判断这是一个帧站超时后发出位置的时命令询问站的状态站以响应于是数据传送从断点处恢复标准协议的基本原理是站在发送数据之前先监听信道上是否有别的站发送的载波信号若有说明信道正忙否则说明信道是空闲的然后根据预定的策略决定若信道空闲是否立即发送若信道忙是否继续监听即使信道空闲若立即发送仍然会发生冲突一种情况是远端的站刚开始发送载波信号尚未到达监听站这时监听站若立即发送就会和远端的站发生冲突另一种情况是虽然暂时没有站发送但碰巧两个站同时开始监听如果它们都立即发送也会发生冲突所以上面的控制策略的第点就是想要避免这种虽然稀少但仍可能发生的冲突若信道忙时如果坚持监听发送的站一旦停止就可立即抢占信道但是有可能几个站同时都在监听同时都抢占信道从而发生冲突以上控制策略的第点就是进一步优化监听算法使得有些监听站或所有监听站都后退一段随机时间再监听以避免冲突二进制指数后退算法检测到冲突发送干扰信号后退一段时间重新发送后退时间的多少对网络的稳定工作有很大影响特别是在负载很重的情况下为了避免很多站连续发生冲突需要设计有效的后退算法按照二进制指数后退算法后退时延的取值范围与重发次数形成二进制指数关系或者说随着重发次数的增加后退时延占的取值范围按的指数增大即第一次试发送时的值为每冲突一次的值加并按下式计算后退时延其中第一式是在区间上取一均匀分布的随机整数第二式是计算出随机后退时延为了避免无限制的重发要对重发次数进行限制这种情况往往是信道故障引起的通常当增加到某一最大值例如时停止发送并向上层协议报告发送错误当然还可以用其他的后退算法但二进制指数后退算法考虑了网络负载的变化情况事实上后退次数的多少往往与负载大小有关二进制指数后退算法的优点正是把后退时延的平均取值与负载的大小联系了起来局域网互连局域网通过网桥互连标准中有两种关于网桥的规范一种是定义的透明网桥生成树网桥另一种是标准中定义的源路由网桥生成树网桥这是一种完全透明的网桥这种网桥插入电缆后就可以自动完成路由选择的功能无须由用户装入路由表或设置参数网桥的功能是自己学习获得的生成树网桥的原理包括帧转发地址学习和环路分解网桥为了能够决定是否转发一个帧必须为每个转发端口保存一个转发数据库数据库中保存着必须通过该端口转发的所有站的地址假定网桥从端口收到一个帧转发机制如下查找除输入端口之外的其他转发数据库如果没有发现目标地址则丢弃帧如果在某个端口的转发数据库中发现目标地址井且端口没有阻塞阻塞的原因下面讲述则把收到的帧从端口发送出去若端口阻塞则丢弃该帧地址学习机制可以使网桥从无到有地自行决定每一个站的转发方向如果一个帧从某个端口到达网桥显然它的源工作站处于网桥的入口一边从帧的源地址字段可以知道该站的地址于是网桥据此更新相应端口的转发数据库为了应付网络拓扑结构的改变转发数据库的每一数据项站地址都配备一个定时器生成树算法用于消除环路由环路引起的循环转发破坏了网桥的数据库使得网桥无法获得正确的转发信息克服这个问题的思路就是要设法消除环路从而避免出现互相转发的情况有一种提取连通图生成树的简单算法可以用于因特网消除其中的环路在因特网中每一个对应于连通图的一个顶点而每一个网桥对应于连通图的一个边删去连通图的一个边等价于移去一个网桥凡是构成回路的网桥都可以逐个移去最后得到的生成树不含回路但又不改变网络的连通性源路由网桥生成树网桥的优点是易于安装无须人工输入路由信息但是这种网桥只利用了网络拓扑结构的一个子集没有最好地利用带宽所以标准中给出了另一种网桥路由策略源路由网桥源路由网桥的核心思想是由帧的发送者显式地指明路由信息路由信息由网桥地址和标识符的序列组成包含在帧头中每个收到帧的网桥根据帧头中的地址信息可以知道自己是否在转发路径中并可以确定转发的方向在这种方案中网桥无须保存路由表只需记住自己的地址标识符和它所连接的标识符就可以根据帧头中的信息做出路由决策然而发送帧的工作站必须知道网络的拓扑结构了解目标站的位置才能给出有效的路由信息在标准中有各种路由指示和寻址模式用于解决源站获取路由信息的问题高速以太网快速以太网年的快速以太网标准正式颁布这是基于和技术在基本布线系统不变的情况下开发的高速局域网标准快速以太网的物理层规范如表所示其中多模光纤的芯线直径为包层直径为单模光纤的芯线直径为包层直径也是干兆以太网以太网的传输速率更快作为主干网提供无阻塞的数据传输服务年月成立了工作组开始制定以太网标准后来又成立了有多家公司参加的千兆以太网联盟支持工作组的各项活动年月公布的和年月公布的已经成为千兆以太网的正式标准它们规定了种传输介质如表所示实现千兆数据速率需要采用新的数据处理技术首先是最小帧长需要扩展以便在半双工的情况下增加跨距另外还定义了一种帧突发方式使得一个站可以连续发送多个帧最后物理层编码也采用了与不同的编码方法即或编码法千兆以太网标准适用于已安装的综合布线基础之上以保护用户的投资万兆以太网年月标准发布支持的传输速率相应的标准如表所示传统以太网采用协议即带冲突检测的载波监听多路访问技术与千兆以太网一样万兆以太网基本应用于点到点线路不再共享带宽没有冲突检测载波监昕和多路访问技术也不再重要千兆以太网和万兆以太网采用与传统以太网同样的帧结构虚拟局域网虚拟局域网是根据管理功能组织机构或应用类型对交换局域网进行分段而形成的逻辑网络虚拟局域网与物理局域网具有同样的属性然而其中的工作站可以不属于同一个物理网段任何交换端口都可以分配给某个属于同一个的所有端口构成一个广播域每一个都是一个逻辑网络发往之外的分组必须通过路由器进行转发在交换机上实现可以采用静态的或动态的方法静态分配为交换机的各个端口指定所属的这种基于端口的划分方法是把各个端口固定地分配给不同的任何连接到交换机的设备都属于接入端口所在的动态分配动态通过网络管理软件包来创建可以根据设备的地址网络层协议网络层地址广播域或管理策略来划分根据地址划分的方法应用最多一般交换机都支持这种方法无论一台设备连接到交换网络的什么地方接入交换机根据设备的地址就可以确定该设备的成员身份这种方法使得用户可以在交换网络中改变接入位置而仍能访问所属的但是当用户数量很多时对每个用户设备分配的工作量是很大的管理负担把物理网络划分成的好处有控制网络流量提高网络的安全性以及灵活的网络管理定义了帧标记的格式在原来的以太帧中增加了个字节的标记字段如图所示其中标记控制信息包含和个部分冗余网关技术在进行大中型网络设计时网络核心设备的备份是设计者必须要考虑的问题就如同服务器采用多硬盘提高数据的安全性一样路由器作为整个网络的核心设备如果发生致命性的故障将导致本地网络的瘫痪在进行网络规划时通常将个或个以上的路由器互为热备如果有一台路由器出故障不能正常工作路由将自动切换到其他路由器上这种机制也称为网络系统中的心跳机制在网络系统中采用心跳机制的协议通常包括虚拟路由冗余协议热备份路由器协议网关负载均衡协议在网络规划时通常将解决此类问题的技术称为冗余网关技术是国际标准协议多见于国产设备及网络平台与是思科网络的专有协议通常只应用在其私有平台是由提出的解决局域网中配置静态网关出现单点失效现象的路由协议年推出正式的协议标准可以将理解成一种选择协议它可以把一个虚拟路由器担负的任务动态分配到局域网上的路由器中的一台控制虚拟路由器地址的路由器称为主路由器它负责转发数据包到这些虚拟地址一旦主路由器不可用这种选择过程就提供了动态的故障转移机制允许虚拟路由器的地址作为终端主机的默认第一跳路由器这样主机发出的目的地址不在本网段的报文将被通过缺省网关发往三层交换机从而实现了主机和外部网络的通信也可以将理解成一种路由容错协议也可以叫作备份路由协议当缺省路由器掉即端口关闭之后内部主机将无法与外部通信如果路由器设置了那么这时虚拟路由将启用备份路由器从而实现全网通信在协议中有两组重要的概念路由器和虚拟路由器主控路由器和备份路由器路由器是指运行的路由器是物理实体虚拟路由器是指协议创建的是逻辑概念一组路由器协同工作共同构成一台虚拟路由器该虚拟路由器对外表现为一个具有唯一固定的地址和地址的逻辑路由器处于同一个组中的路由器具有两种互斥的角色主控路由器和备份路由器一个组中有且只有一台处于主控角色的路由器可以有一个或者多个处于备份角色的路由器协议从路由器组中选出一台作为主控路由器负责解析和转发数据包组中的其他路由器作为备份的角色井处于待命状态当由于某种原因主控路由器发生故障时其中的一台备份路由器能在瞬间的时延后升级为主控路由器由于此切换非常迅速而且不用改变地址和地址故对终端使用者系统是透明的热备份路由器协议的设计目标是支持特定情况下流量失败转移不会引起混乱并允许主机使用单路由器以及即使在实际第一跳路由器使用失败的情形下仍能维护路由器间的连通性负责转发数据包的路由器称为主动路由器一旦主动路由器出现故障将激活备份路由器取代主动路由器协议提供了一种决定使用主动路由器还是备份路由器的机制并指定一个虚拟的地址作为网络系统的缺省网关地址如果主动路由器出现故障备份路由器承接主动路由器的所有任务并且不会导致主机连通中断现象运行在上采用端口号路由器转发协议数据包的源地址使用的是实际地址而并非虚拟地址正是基于这一点路由间能相互识别实现的条件是系统中有多台路由器它们组成一个热备份组这个组形成一个虚拟路由器在任一时刻一个组内只有一个路由器是活动的并由它来转发数据包如果活动路由器发生了故障将选择一个备份路由器来替代活动路由器但是在本网络内的主机看来虚拟路由器没有改变所以主机仍然保持连接没有受到故障的影响为了减少网络的数据流量在设置完活动路由器和备份路由器之后只有活动路由器和备份路由器定时发送报丈如果活动路由器失效备份路由器将接管成为活动路由器如果备份路由器失效或者变成了活跃路由器将由另外的路由器被选为备份路由器协议利用一个优先级方案来决定哪个配置了协议的路由器成为默认的主动路由器路由器的缺省优先级是所以如果只设置一个路由器的优先级高于则该路由器将成为主动路由器通过在设置了协议的路由器之间广播优先级协议选出当前的主动路由器当在预先设定的一段时间内主动路由器不能发送消息时优先级最高的备用路由器变为主动路由器路由器之间的包传输对网络上的所有主机来说都是透明的与不同的是不仅提供冗余网关还在各网关之间提供负载均衡而都必须选定一个活动路由器而备用路由器则处于闲置状态和不同的是可以绑定多个地址到虚拟从而允许客户端选择不同的路由器作为其默认网关而网关地址仍使用相同的虚拟从而实现一定的冗余优先级最高的路由器成为活动路由器称作其他非提供元余某路由器被推举为后分配虚拟的地址给其他组成员所有的组中的路由器都转发包但是各路由器只负责转发与自己的虚拟地址相关的数据包通常来说和的区别在于是否同时只存在一个物理端口处于状态与的区别在于设备间的认证机制初始状态报文数量安全性等方面略有不同主备备份配置示例的主备备份配置的连接拓扑图如图所示通过双归属到和主机以为默认网关接入当故障时接替作为网关继续进行工作实现网关的冗余备份故障恢复后可以重新成为网关采用主备备份实现网关冗余备份包括如下步骤配置各设备接口地址及路由协议使各设备间网络层连通在和上配置备份组其中上配置较高优先级和秒抢占延时作为设备承担流量转发上配置较低优先级作为备用路由器实现网关冗余备份配置设备间的网络互连配置设备各接口的地址以为例和的配置与类似配置和间采用协议进行互连以为例和的配置与类似配置备份组在上创建备份组配置在该备份组中优先级为并配置抢占时间为在上创建备份组其在该备份组中的优先级为缺省值测试配置结果完成上述配置以后在和上分别执行命令可以看到在备份组中的状态为在备份组中的状态为在的接口上执行命令模拟出现故障在上执行命令查看状态信息可以看到的状态是在的接口上执行命令等待秒后在上执行命令查看状态信息可以看到的状态恢复成以太环网保护技术以太环网技术日趋成熟且成本低廉在城域网和企业网采用以太环网已经成为一种趋势但以太网协议采用的报文分发复制机制在解决设备相互认识的同时也容易引发广播风暴因此在以太环网的构建时就必须考虑采用什么样的保护技术来避免此类故障的产生通常情况下解决二层网络环路问题的技术是因其收敛的时间比较长秒级并不适用于主干线路的保护年月标准规范了弹性分组环的介质访问控制方法物理层接口以及层管理参数并提出了用于环路检测和配置失效恢复以及带宽管理的一系列协议标准也定义了环网与各种物理层的接口和系统管理信息库支持的数据速率可达针对承载业务进行了优化是一种相对典型的以太环网的保护技术弹性分组环的体系结构如图所示服务接口提供上层协议的服务原语控制子层控制数据通路维护状态并协调各种功能的相互作用数据通路子层提供数据传输功能子层通过服务接口发送接收分组采用了双环结构由内层的环和外层的环组成每个环都是单方向传送如图所示相邻工作站之间的跨距包含传送方向相反的两条链路如果站接收站发出的分组则是的下游站而是的上游站支持多达个工作站最大环周长为中包括如下关键技术帧结构位于数据链路层包括逻辑链路控制子层控制子层数据通路子层与控制子层之间是服务接口服务接口支持把来自的数据传送到一个或多个远端同样的逻辑链路控制子层控制子层执行与特定小环无关的数据寻路行为和维护状态所需要的控制行为控制子层与数据通道子层之间发送或接收帧数据通路子层则与某个特定的小环之间执行访问控制和数据传送物理层服务接口用于数据通路子层向物理媒介发送或从物理媒介接收帧对数据帧的处理方式对数据帧的处理方式有上环下环过环以及剥离种上环是指本点用户端口向环上其他站点发送信息时需要进行上环操作通过拓扑发现和路由表项决定其目的站点地址以及环选择根据对应的优先级送入相应的队列最后产生帧头后插入到各环端口下环是指本点从环上接收其他站点发送过来的到本点的单播帧或多播帧经过过滤后接收对于单播帧将其从环上剥离井发送到用户端口对于多擂帧将其发送到用户端口的同时进行过环操作过环是指本点从环上接收的帧根据其优先级分别放入和转发通道发送时将和队列中的数据帧直接插入源环发送端口剥离是指本点从环上接收的帧不再继续向下传递到本点终结公平算法原理技术所采用的公平算法是一种保证环上所有站点之间公平性的机制通过这种算法可以达到带宽的动态调整和共享的目的公平算法的主要作用有两个一是应用于从客户来的低优先级服务和超额中优先级服务即中优先级服务中数据帧的业务对于类以及类业务不进行控制二是分别控制两个子环的公平带宽即每个有两个互相独立的公平协议分别调整上环的带宽公平算法是通过对阻塞的检测来触发带宽调整而实现的当环上某一个节点发生阻塞时它就会在相反的环上向上行节点发布一个公平速率当上行站点收到这个公平速率时就调整自己的发送速率以不超过公平速率接收到这个公平速率的站点会根据不同情况做出两种反应若当前节点阻塞它就在自己的公平速率通过本点的和归一化的权重得到和收到的公平速率之间选择最小值公布给上行节点若当前节点不阻塞节点就将公平速率向上游继续传递拓扑发现原理通过的拓扑发现原理可以使每个站点都能了解环的完整结构各点距离自身的跳数以及环上各个站点所具备的能力等从而为环选择公平算法保护等单元提供决策依据拓扑发现是一种周期性的活动但是也可以由某一个需要知道拓扑的节点发起也就是说某个节点可以在必要的时候产生一个拓扑信息帧如此节点刚刚进入环中接收到一个保护切换需求信息或者节点监测到了光纤链路差错的拓扑信息产生周期可以任意配置一般为以为最小分辨率默认值为保护原理层保护可支持保护或保护用户可以指配是否同时采用层的保护和物理层的保护当同时采用层保护和保护时可以采用拖延层倒换时间来支持层间倒换以保证两种倒换不会重叠发生的保护时间有拖延时间和等待恢复时间两种拖延时间为检测到业务失效到启动倒换之间的等待时间时间范围为步进级别为在这段时间内如果业务恢复将不发生倒换等待恢复时间为从故障恢复到业务故障状态清除取消保护状态之间的等待时间时间范围为步进级别为秒级可设置默认为在这段时间内如果业务失效业务故障状态将不再清除以太网环保护交换在年月举行的会议上对以太环网保护标准的版本进行修订增加以太网环保护交换方案形成以太环网标准该标准吸取了等众多环网保护技术的优点优化了检测机制可以检测双向故障支持多环多域的结构在实现倒换的同时支持主备负荷分担多种工作方式成为二层网络中重要的冗余保护手段下面按照链路正常链路故障链路恢复的过程包括保护倒换操作介绍基本的单环组网下盯的实现原理链路正常如图所示由组成的环路上各设备通信正常为防止环路产生首先会阻塞端口如果配置了端口该端口同样会被阻塞其他端口可以正常转发业务流量环上的端口以的时间间隔为周期向环中其他节点发送报文表示环当前链路一切正常链路故障如图所示当和之间的链路发生故障时协议启动保护倒换机制将故障链路的两端端口阻塞然后放开端口和端口这两个端口重新恢复用户流量的接收和发送从而保证了流量不中断具体处理过程如下和检测到链路故障将故障链路上的端口阻塞并刷新本设备的表项然后和向外发送携带本地端口链路故障消息的报文即一旦感知到链路故障和会连续发送个相同的报文然后以的间隔持续稳定发送其他设备收到和发送的报文后都刷新本设备的表项当设备端口所在设备收到该报文后放开端口并刷新自己的表项同样当设备端口所在设备收到报文后放开端口井刷新自己的表项链路恢复链路恢复正常后如果环配置的是回切模式端口所在设备会重新阻塞链路上的流量故障链路重新被用来完成用户流量的传送如果环配置的是非回切模式阻塞链路还保持在原来的故障链路上不会重新切回到上以回切模式为例具体恢复过程如下当和之间的链路恢复后和为了防止收到过期的协议报文分别启动定时器在该定时器超时前不接收其他协议报文同时和会向外发送报文当端口所在设备收到报文后启动定时器当该定时器超时后端口被阻塞同时向外发送报文当和收到发送的协议报文后将自己设备上原来阻塞的端口放开停止发送协议报文并且完成表项的刷新其他设备收到发送的协议报文后也完成表项的刷新保护倒换强制切换如图所示当由组成的环路上各设备通信正常时在设备与相连的端口上执行强制切换将端口阻塞端口和端口同样会被放开这两个端口重新恢复用户流量的接收和发送从而保证了流量不中断具体处理过程如下与相连的端口被强制阻塞后刷新本设备的表项城域网城域网比局域网的传输距离远能够覆盖整个城市范围城域网有更大的传输容量更高的传输效率还要有多种接入手段以满足不同用户的需要城域网作为开放型的综合平台要求能够提供分组传输的数据语音图像和视频等多媒体综合业务城域以太网论坛是由网络设备制造商和网络运营商组成的非营利性组织专门从事城域以太网的标准化工作的承载以太网技术规范提出了以下几种业务类型以太网专用线在一对用户以太网之间建立固定速率的点对点专线连接以太网虚拟专线在一对用户以太网之间通过第三层技术提供点对点的虚拟以太网连接支持承诺的信息速率峰值信息速率和突发式通信以太局域网服务由运营商建立一个城域以太网在用户以太网之间提供多点对多的第二层连接任意两个用户以太网之间都可以通过城域以太网通信其中的第种技术被认为是最有前途的解决方案提供服务的基本技术是的帧标记假定各个用户的以太网称为网运营商建立的城域以太网称为网如果不同网中的用户要进行通信以太帧在进入用户网络接口时被插入一个字段用于标识网中的传输服务而用户的帧标记则保持不变当以太帧到达目标网时字段被删除如图所示这样就解决了两个用户以太网之间透明的数据传输问题这种技术定义在的运营商网桥协议中被称为技术实际上是把用户嵌套在城域以太网的中传送由于其简单性和有效性而得到电信运营商的青睐但是这样一来所有用户的地址在城域以太网中都是可见的任何网的改变都会影响到网的配置增加了管理的难度而且字段只有位只能标识个不同的传输服务网络的可扩展性也受到限制从用户角度看网络用户的地址都暴露在整个城域以太网中使得网络的安全性受到威胁为了解决上述问题标准提出了运营商主干网桥协议所谓主干网桥就是运营商网络边界的网桥通过对用户以太帧再封装一层运营商的帧头添加主干网目标地址和源地址主干网标识以及服务标识等字段如图所示由于用户以太帧被封装在主干网以太帧中所以这种技术被称为技术按照协议主干网与用户网具有不同的地址空间主干网的核心交换机只处理通常的以太网帧头仅主干网边界交换机才具有功能这样用户网和主干网被隔离使得扁平式的以太网变成了层次化结构简化了网络管理保证了网络安全协议规定的服务标识字段为位可以区分万种不同的服务使得网络的扩展性得以提升由于采用了二层技术没有复杂的信令机制因此设备成本和维护成本较低被认为是城域以太网的最终解决方案目前标准正在完善之中',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-11-05 18:13:09',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">JYhe</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>6</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" style="font-size: 1.05rem;">网络规划设计师<sup>6</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">November 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">October 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92/" itemprop="url">网络规划</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络规划设计师</span></a><a class="article-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>基础知识</span></a></span></div></div><h1 class="post-title" itemprop="name headline">网规基础4局域网，广域网</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-11-01T19:06:00.000Z" title="Created 2025-11-02 03:06:00">2025-11-02</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-11-05T10:13:09.910Z" title="Updated 2025-11-05 18:13:09">2025-11-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广东</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/default_cover.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92/" itemprop="url">网络规划</a><a href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" tabindex="-1" itemprop="url">网络规划设计师</a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url">基础知识</a><h1 id="CrawlerTitle" itemprop="name headline">网规基础4局域网，广域网</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">JYhe</span><time itemprop="dateCreated datePublished" datetime="2025-11-01T19:06:00.000Z" title="Created 2025-11-02 03:06:00">2025-11-02</time><time itemprop="dateCreated datePublished" datetime="2025-11-05T10:13:09.910Z" title="Updated 2025-11-05 18:13:09">2025-11-05</time></header><h1>局域网</h1>
<h2 id="HDLC协议">HDLC协议</h2>
<p>HDLC(HighLevelDataLinkControl，高级数据链路控制)协议是国际标准化组织根据IBM公司的SDLC(SynchronousDataLinkControl，同步数据链路控制)协议扩充开发而成的。美国国家标准学会(ANSI)则根据SDLC开发出类似的协议，叫作ADCCP协(AdvancedDataCommunicationControlProcedure，高级数据通信控制协议)。</p>
<h3 id="1-HDLC的基本配置">1.HDLC的基本配置</h3>
<p>HDLC定义了3种类型的站、两种链路配置和3种数据传输方式。3种站分别如下:</p>
<p>(1)<strong>主站</strong>。对链路进行控制，主站发出的帧叫命令帧。</p>
<p>(2)<strong>从站</strong>。在主站控制下进行操作，从站发出的帧叫响应帧。</p>
<p>(3)<strong>复合站</strong>。具有主站和从站的双重功能。复合站既可以发送命令帧也可以发出响应帧。</p>
<p>两种链路配置如下:</p>
<p>(1)<strong>不平衡配置</strong>。适用于点对点和点对多点链路。这种链路由一个主站和一个或多个从站组成，支持全双工或半双工传输。</p>
<p>(2)<strong>平衡配置</strong>。仅用于点对点链路。这种配置由两个复合站组成，支持全双工或半双工传输。</p>
<p>3种数据传输方式如下:</p>
<p><strong>正常响应方式</strong>(NormalResponseMode，NRM)。适用于不平衡配置，只有主站能启动数据传输过程，从站收到主站的询问命令时才能发送数据。</p>
<p><strong>异步平衡方式</strong>(AsynchronousBalancedMode,ABM)。适用于平衡配置，任何一个复合站都无须取得另一个复合站的允许就可以启动数据传输过程.</p>
<p><strong>异步响应方式</strong>(AsynchronousResponseMode,ARM)。适用于不平衡配置，从站无须取得主站的明确指示就可以启动数据传输，主站的责任只是对线路进行管理。正常响应方式可用于计算机和多个终端相连的多点线路上，计算机对各个终端进行轮询以实现数据输入。正常响应方式也可以用于点对点的链路上，例如计算机和一个外设相连的情况。异步平衡方式能有效地利用点对点全双工链路的带宽，因为这种方式没有轮询的开销。异步响应方式的特点是各个从站轮流询问中心站，这种传输方式很少使用。</p>
<h3 id="2-HDLC的帧结构">2.HDLC的帧结构</h3>
<p>HDLC使用统一的帧结构进行同步传输，图所示为HDLC的帧结构。从图中可以看出，HDLC帧由6个字段组成。以两端的标志字段(F)作为帧的边界，在信息字段(INFO)中包含了要传输的数据。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/HDLC%E7%9A%84%E5%B8%A7%E7%BB%93%E6%9E%84.jpg" alt="HDLC 的帧结构"></p>
<p>下面对HDLC帧的各个字段分别予以解释。</p>
<p>(1)<strong>帧标志F</strong>。HDLC用一种特殊的位模式。01111110作为帧的边界标志。链路上所有的站都在不断地探索标志模式，一旦得到一个标志就开始接收帧。在接收帧的过程中如果发现一个标志，则认为该帧结束了。由于帧中间出现位模式01111110时也会被当作标志，从而破坏了帧的同步，所以要使用位填充技术。发送站的数据位序列中一旦发现0后有5个1，则在第7位插入一个0，这样就保证了传输的数据中不会出现与帧标志相同的位模式。接收站则进行相反的操作:在接收的位序列中如果发现0后有5个1，则检查第7位，若第7位为0则删除;若第7位是1且第8位是0，则认为是检测到帧尾的标志:若第7位和第8位都是1，则认为是发送站的停止信号。有了位填充技术，任意的位模式都可以出现在数据帧中，这个特点叫作透明的数据传输。</p>
<p>(2)<strong>地址字段A</strong>。地址字段用于标识从站的地址，用在点对多点链路中。地址通常是8位长，然而经过协商之后，也可以采用更长的扩展地址。扩展的地址字段如图所示，可以看出，它是8位组的整数倍。每一个8位组的最低位表示该8位组是否是地址宇段的结尾:若为1，表示是最后的8位组:若为0，则不是。所有8位组的其余7位组成了整个扩展地址字段。全为1的8位组(11111111)表示广播地址。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/HDLC%E6%8B%93%E5%B1%95%E5%9C%B0%E5%9D%80.jpg" alt="HDLC拓展地址"></p>
<p>(3)<strong>控制字段C</strong>。HDLC定义了3种帧，可根据控制宇段的格式区分。信息帧(I帧)承载着要传送的数据，此外还捎带着流量控制和差错控制的应答信号。管理帧cs帧)用于提供ARQ控制信息，当不使用捎带机制时要用管理帧控制传输过程。无编号帧cu帧)提供建立、释放等链路控制功能，以及少量信息的无连接传送功能。控制字段第1位或前两位用于区别3种不同格式的帧，如图所示。基本的控制字段是8位长，扩展的控制字段为16位长。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E6%8E%A7%E5%88%B6%E5%AD%97%E6%AE%B5%E6%A0%BC%E5%BC%8F.jpg" alt="控制字段格式"></p>
<p>(4)<strong>信息字段剧FO</strong>。只有I帧和某些无编号帧含有信息宇段。这个字段可含有用于表示用户数据的任何序列，其长度没有规定，但具体的实现往往限定了最大帧长。</p>
<p>(5)<strong>帧校验序列F</strong>CSaFCS中含有各个字段的校验(标志字段除外)。通常使用CRC-CCITT标准产生16位校验序列，有时也使用CRC-32产生32位校验序列。</p>
<p>3.HDLC的帧类型 HDLC协议的帧类型如表所示。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/HDLC%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B8%A7%E7%B1%BB%E5%9E%8B1.jpg" alt=""></p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/HDLC%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B8%A7%E7%B1%BB%E5%9E%8B2.jpg" alt=""></p>
<p>下面结合HDLC的操作介绍这些帧的作用。</p>
<p>(1)<strong>信息帧</strong>。信息帧除承载用户数据之外还包含该帧的编号NC韵，以及捎带的肯定应答顺序号NCR)。I帧还包含一个P/F位，在主站发出的命令帧中这一位表示P,ElP轮询(Polling);在从站发出的响应帧中这一位是F位，即终止位(Final)。在正常响应方式下，主站发出的I格式命令帧中的P/F位置1，表示该帧是询问帧，允许从站发送数据。从站响应主站的询问，可以发送多个响应帧，其中仅最后一个响应帧的P/F位置l，表示一批数据发送完毕。在异步响应方式和异步平衡方式下，P/F位用于控制S帧和U帧的交换过程。</p>
<p>(2)<strong>管理帧</strong>。管理帧用于进行流量和差错控制，当没有足够多的信息帧捎带管理命令/响应时，要发送专门的管理帧来实现控制。从表1-4看出，有4种管理帧可以用控制字段中的两个S位来区分。RR帧表示接收就绪，它既是对NCR)之前帧的确认，也是准备接收NCR)及其后续帧的肯定应答。时-l’R帧表示接收未就绪，在对NCR)之前的帧给予肯定应答的同时，拒绝进一步接收后续帧。REJ帧表示拒绝接收NCR)帧，要求重发NCR)帧及其后续帧。显然，REJ用于后退N帧ARQ流控方案中。类似地，SREJ帧用于选择重发ARQ流控方案中。</p>
<p>管理帧中P/F位的作用如下所述:主站发送P位置1的阻帧询问从站，是否有数据要发送。如果从站有数据要发送，则以信息、帧响应;否则从站以F位置1的阻帧响应，表示没有数据可发送。另外，主站也可以发送P位置l的RNR帧询问从站的状态。如果从站可以接收信息帧，则以F位置l的阻帧响应:反之，如果从站忙，则以F位置1的RNR帧响应。</p>
<p>(3)<strong>无编号帧</strong>。无编号帧用于链路控制。这类帧不包含编号字段，也不改变信息帧流动的顺序。无编号帧按其控制功能可分为以下几个子类:</p>
<p>•  设置数据传输方式的命令和响应帧。</p>
<p>•  传输信息的命令和响应帧。</p>
<p>•  用于链路恢复的命令和响应帧。</p>
<p>其它命令和相应帧 设置数据传输方式的命令由主站发送给从站，表示设置或改变数据传输方式。SARM和SABM分别对应3种数据传输方式。SNRME、SARME和SABME也是设置数据传输方式的命令帧，然而这3种传输方式使用两个字节的控制域。从站接收了设置传输方式的命令帧后以无编号应答帧CUA)响应。一种传输方式建立后一直保持有效，直到另外的设置方式命令改变了当前的传输方式。主站向从站发送置初始化方式命令(SIM)，使得接收该命令的从站启动一个建立链路的过程。在初始化方式下，两个站用无编号信息帧(UI)交换数据和命令。拆除连接命令(DISC)用于通知对方链路已经释放，对方站以UA帧响应，链路随之断开。 除UA帧之外，还有儿种响应帧与传输方式的设置有关。非连接方式帧(DM)可用于晌应所有的置传输方式命令，表示响应的站处于逻辑上断开的状态，即拒绝建立指定的传输方式。请求初始化方式帧CRIM)也可用于响应置传输方式命令，表示响应站没有准备好接收命令，或正在进行初始化。请求拆除连接帧(RD)则表示响应站要求断开逻辑连接。信息传输的命令和响应用于两个站之间交换信息。无编号信息帧CUI)既可作为命令帧，也可作为响应帧。UI帧传送的信息可以是高层的状态、操作中断状态、时间、链路初始化参数等。主站/复合站可发送无编号询问命令CUP)请求接收站送回无编号响应帧，以了解它的状态。 链路恢复命令和响应用于ARQ机制不能正常工作的情况下。接收站可用帧拒绝响应(FRMR)表示接收的帧中有错误。例如，控制宇段无效、信息字段太长、帧类型不允许携带信息以及捎带的NCR)无效等。 复位命令CRSET)表示发送站正在重新设置发送顺序号，这时接收站也应该重新设置接收顺序号。 还有两种命令和响应不能归入以上几类。交换标识CXID)帧用于在两个站之间交换它们的标识和特征，实际交换的信息依赖于具体的实现。测试命令帧(TEST)用于测试链路和接收站是否正常工作。接收站收到测试命令后要尽快以测试帧响应。 4.HDLC的操作 下面通过图1-24的例子说明HDLC的操作过程，这些例子虽然不能囊括实际运作中的所有情况，但是可以帮助读者理解各种命令和响应的使用方法。由于HDLC定义的命令和响应非常多，可以实现各种应用环境的所有要求，所以对于任何一种特定的应用，只要实现一个子集就可以了，以下给出的例子都是实际应用中的典型情况。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/HDLC%E6%93%8D%E4%BD%9C%E4%B8%BE%E4%BE%8B.jpg" alt=""></p>
<p>在图中，用I表示信息帧，I后面的两个数字分别表示信息帧中的N(S)和N®值。管理帧和无编号帧都直接给出帧名字，管理帧后的数字则表示帧中的N®值，P和F表示该帧中的P/F位置l，没有P和F表示这一位置0。<br>
<strong>图(a)</strong> 说明了链路建立和拆除的过程。A站发出SABM命令井启动定时器，在一定的时间内没有得到应答后重发同一命令。B站以UA帧响应，并对本站的局部变量和计数器进行初始化。A站收到应答后也对本站的局部变量和计数器进行初始化，并停止计时，这时逻辑链路就建立起来了。拆除链路的过程由双方交换一对命令DISC和响应UA完成。在实际使用中可能出现链路不能建立的情况，B站以DM响应A站的SABM命令，或者A站重复发送SABM命令预定的次数后放弃建立连接，向上层实体报告链接失败。</p>
<p><strong>图(b)</strong> 说明了全双工交换信息帧的过程。每个信息帧中用N(S)指明发送顺序号，用N®指明接收顺序号。当一个站连续发送了若干帧而没有收到对方发来的信息帧时，N®字段只能简单地重复。例如，A发给B的111和121。最后A站没有信息帧要发时用一个管理帧RR4对B站给予应答。图中也表示出了肯定应答的积累效应。例如A站发出的RR4帧一次应答了B站的两个数据帧。</p>
<p><strong>图©</strong> 画出了接收站忙的情况。出现这种情况的原因可能是接收站数据链路层缓冲区溢出，也可能是接收站上层实体来不及处理接收到的数据。图中A站以RNR4响应B站的130帧，表示A站对第3帧之前的帧己正确接收，但不能继续接收下一个帧。B站接收到RNR4后每隔一定时间以P位置l的RNR命令询问接收站的状态。接收站A如果保持忙则以F位置l的RNR帧响应:如果忙状态解除，则以F位置l的RR帧响应，于是数据传送从RR应答中的接收序号恢复发送。</p>
<p><strong>图(d)</strong> 描述了使用REJ命令的例子。A站发出了第3、4、5信息帧，其中第4帧出错。接收站检出错误帧后发出REJ4命令，发送站返回到出错帧重发。这是使用后退N帧ARQ技术的典型情况。</p>
<p><strong>图(e)</strong> 表示的是超时重发的例子。A站发出的第3帧出错，B站检测到错误后丢弃了它。但是，B站不能发出REJ命令，因为B站无法判断这是一个I帧。A站超时后发出P位置l的时RNR命令询问B站的状态。B站以RR3F响应，于是数据传送从断点处恢复。</p>
<h1>IEEE802.3标准</h1>
<h2 id="CSMA-CD协议">CSMA/CD协议</h2>
<p>CSMA的基本原理是:站在发送数据之前，先监听信道上是否有别的站发送的载波信号。若有，说明信道正忙，否则说明信道是空闲的，然后根据预定的策略决定:</p>
<p>(1)若信道空闲，是否立即发送。<br>
(2)若信道忙，是否继续监听。<br>
即使信道空闲，若立即发送仍然会发生冲突。一种情况是远端的站刚开始发送，载波信号尚未到达监听站，这时监听站若立即发送，就会和远端的站发生冲突;另一种情况是虽然暂时没有站发送，但碰巧两个站同时开始监听，如果它们都立即发送，也会发生冲突。所以，上面的控制策略的第1点就是想要避免这种虽然稀少，但仍可能发生的冲突。若信道忙时，如果坚持监听，发送的站一旦停止就可立即抢占信道。但是，有可能几个站同时都在监听，同时都抢占信道，从而发生冲突。以上控制策略的第(2)点就是进一步优化监听算法，使得有些监听站或所有监听站都后退一段随机时间再监听，以避免冲突。</p>
<h2 id="二进制指数后退算法">二进制指数后退算法</h2>
<p>检测到冲突发送干扰信号后退一段时间重新发送。后退时间的多少对网络的稳定工作有很大影响。特别是在负载很重的情况下，为了避免很多站连续发生冲突，需要设计有效的后退算法。按照二进制指数后退算法，后退时延的取值范围与重发次数n形成二进制指数关系。或者说，随着重发次数n的增加，后退时延t占的取值范围按2的指数增大。即第一次试发送时n的值为0，每冲突一次n的值加l，并按下式计算后退时延:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>ξ</mi><mo>=</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>m</mi><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><msup><mn>2</mn><mi>n</mi></msup><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>t</mi><mi>ξ</mi></msub><mo>=</mo><mi>ξ</mi><mi>τ</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{equation}
\begin{cases}
\xi=random[0,2^n]\\
t_\xi=\xi\tau
\end{cases}
\end{equation}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.75em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mclose">]</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04601em;">ξ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.75em;"><span class="pstrut" style="height:3.75em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span>
<p>其中，第一式是在区间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><msup><mn>2</mn><mi>n</mi></msup><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,2^n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>上取一均匀分布的随机整数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi></mrow><annotation encoding="application/x-tex">\xi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span></span></span></span>，第二式是计算出随机后退时延。为了避免无限制的重发，要对重发次数n进行限制，这种情况往往是信道故障引起的。通常当n增加到某一最大值(例如16)时，停止发送，并向上层协议报告发送错误。当然，还可以用其他的后退算法，但二进制指数后退算法考虑了网络负载的变化情况。事实上，后退次数的多少往往与负载大小有关，二进制指数后退算法的优点正是把后退时延的平均取值与负载的大小联系了起来。</p>
<h2 id="局域网互连">局域网互连</h2>
<p>局域网通过网桥互连。IEEE802标准中有两种关于网桥的规范:一种是802.ld定义的透明网桥(生成树网桥):另一种是802.5标准中定义的源路由网桥。</p>
<p>(1)生成树网桥。这是一种完全透明的网桥，这种网桥插入电缆后就可以自动完成路由选择的功能，无须由用户装入路由表或设置参数，网桥的功能是自己学习获得的。生成树网桥的原理包括帧转发、地址学习和环路分解。网桥为了能够决定是否转发一个帧，必须为每个转发端口保存一个转发数据库，数据库中保存着必须通过该端口转发的所有站的地址。假定网桥从端口X收到一个MAC帧，转发机制如下:</p>
<p>1查找除输入端口之外的其他转发数据库。<br>
2如果没有发现目标地址，则丢弃帧。<br>
3如果在某个端口Y的转发数据库中发现目标地址，井且Y端口没有阻塞(阻塞的原因<br>
下面讲述)，则把收到的MAC帧从Y端口发送出去;若Y端口阻塞，则丢弃该帧。地址学习机制可以使网桥从无到有地自行决定每一个站的转发方向。如果一个MAC帧从某个端口到达网桥，显然它的源工作站处于网桥的入口LAN一边，从帧的源地址字段可以知道该站的地址，于是网桥据此更新相应端口的转发数据库。为了应付网络拓扑结构的改变，转发数据库的每一数据项(站地址)都配备一个定时器。<br>
生成树算法用于消除环路。由环路引起的循环转发破坏了网桥的数据库，使得网桥无法获得正确的转发信息。克服这个问题的思路就是要设法消除环路，从而避免出现互相转发的情况。有一种提取连通图生成树的简单算法，可以用于因特网消除其中的环路。在因特网中，每一个LAN对应于连通图的一个顶点，而每一个网桥对应于连通图的一个边。删去连通图的一个边等价于移去一个网桥，凡是构成回路的网桥都可以逐个移去，最后得到的生成树不含回路，但又不改变网络的连通性。</p>
<p>(2)源路由网桥。生成树网桥的优点是易于安装，无须人工输入路由信息，但是这种网桥只利用了网络拓扑结构的一个子集，没有最好地利用带宽。所以，802.5标准中给出了另一种网桥路由策略-源路由网桥。源路由网桥的核心思想是由帧的发送者显式地指明路由信息。路由信息由网桥地址和LAN标识符的序列组成，包含在帧头中。每个收到帧的网桥根据帧头中的地址信息可以知道自己是否在转发路径中，并可以确定转发的方向。</p>
<p>在这种方案中，网桥无须保存路由表，只需记住自己的地址标识符和它所连接的LAN标识符，就可以根据帧头中的信息做出路由决策。然而，发送帧的工作站必须知道网络的拓扑结构，了解目标站的位置，才能给出有效的路由信息。在802.5标准中有各种路由指示和寻址模式用于解决源站获取路由信息的问题。</p>
<h2 id="高速以太网">高速以太网</h2>
<p>快速以太网</p>
<p>1995年100Mbps的快速以太网标准IEEE802.3u正式颁布，这是基于10Base-T和10Base-F技术，在基本布线系统不变的情况下开发的高速局域网标准。快速以太网的物理层规范如表1-5所示。其中，多模光纤的芯线直径为62.5μm，包层直径为125μm:单模光纤的芯线直径为8μm,包层直径也是125μm。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E5%BF%AB%E9%80%9F%E4%BB%A5%E5%A4%AA%E7%BD%91%E7%89%A9%E7%90%86%E5%B1%82%E8%A7%84%E8%8C%83.jpg" alt=""></p>
<p>干兆以太网</p>
<p><img src="/img/%E5%8D%83%E5%85%86%E4%BB%A5%E5%A4%AA%E7%BD%91%E6%A0%87%E5%87%86.jpg" alt=""><br>
1000Mbps以太网的传输速率更快，作为主干网提供无阻塞的数据传输服务。1996年3月，IEEE成立了802.3z工作组，开始制定100Mbps以太网标准。后来又成立了有100多家公司参加的千兆以太网联盟(GigabitEthernetAlliance,GEA)，支持IEEE802.3z工作组的各项活动。<br>
1998年6月公布的IEEE802.3z和1999年6月公布的IEEE802.3ab已经成为千兆以太网的正式标准，它们规定了4种传输介质，如表1-6所示。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/%E4%B8%87%E5%85%86%E4%BB%A5%E5%A4%AA%E7%BD%91%E6%A0%87%E5%87%86.jpg" alt=""><br>
实现千兆数据速率需要采用新的数据处理技术。首先是最小帧长需要扩展，以便在半双工的情况下增加跨距。另外，802.3z还定义了一种帧突发方式(FrameBursting)，使得一个站可以连续发送多个帧。最后，物理层编码也采用了与10Mbps不同的编码方法，即4B/5B或8B/9B编码法。千兆以太网标准适用于已安装的综合布线基础之上，以保护用户的投资。</p>
<p>万兆以太网</p>
<p>2002年6月，IEEE802.3ae标准发布，支持10Gbps的传输速率，相应的标准如表1-7所示。传统以太网采用CSMA/CD协议，即带冲突检测的载波监听多路访问技术。与千兆以太网一样，万兆以太网基本应用于点到点线路，不再共享带宽，没有冲突检测，载波监昕和多路访问技术也不再重要。千兆以太网和万兆以太网采用与传统以太网同样的帧结构。</p>
<p>tu</p>
<h2 id="虚拟局域网">虚拟局域网</h2>
<p>虚拟局域网(Virtual Local Area Network,VLAN)是根据管理功能、组织机构或应用类型对交换局域网进行分段而形成的逻辑网络。虚拟局域网与物理局域网具有同样的属性，然而其中的工作站可以不属于同一个物理网段。任何交换端口都可以分配给某个VLAN，属于同一个VLAN的所有端口构成一个广播域。每一个VLAN都是一个逻辑网络，发往VLAN之外的分组必须通过路由器进行转发。</p>
<p>在交换机上实现VLAN，可以采用静态的或动态的方法。</p>
<p>(1)静态分配VLAN。为交换机的各个端口指定所属的VLAN。这种基于端口的划分方法是把各个端口固定地分配给不同的VLAN，任何连接到交换机的设备都属于接入端口所在的VLAN。</p>
<p>(2)动态分配VLAN。动态VLAN通过网络管理软件包来创建，可以根据设备的MAC地址、网络层协议、网络层地址、IP广播域或管理策略来划分VLAN。根据MAC地址划分VLAN的方法应用最多，一般交换机都支持这种方法。无论一台设备连接到交换网络的什么地方，接入交换机根据设备的MAC地址就可以确定该设备的VLAN成员身份。这种方法使得用户可以在交换网络中改变接入位置，而仍能访问所属的VLAN。但是，当用户数量很多时，对每个用户设备分配VLAN的工作量是很大的管理负担。<br>
把物理网络划分成VLAN的好处有控制网络流量、提高网络的安全性以及灵活的网络管理。<br>
IEEE802.lq定义了VLAN帧标记的格式，在原来的以太帧中增加了4个字节的标记(Tag)字段，如图所示。其中，标记控制信息(TagControlInformation,TCI)包含Priority、CFI和VID3个部分。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/802.1q%E5%B8%A7%E6%A0%BC%E5%BC%8F.jpg" alt=""></p>
<h1>冗余网关技术</h1>
<p>在进行大、中型网络设计时，网络核心设备的备份是设计者必须要考虑的问题，就如同服务器采用多硬盘RAID提高数据的安全性一样。路由器作为整个网络的核心设备，如果发生致命性的故障，将导致本地网络的瘫痪。</p>
<p>在进行网络规划时，通常将<strong>2个或2个以上的路由器互为热备</strong>，如果有一台路由器出故障不能正常工作，路由将自动切换到其他路由器上，这种机制也称为网络系统中的<strong>心跳机制</strong>。在网络系统中采用心跳机制的协议通常包括<br>
<strong>VRRP(Virtual Router Redundancy Protocol，虚拟路由冗余协议)、</strong><br>
<strong>HSRP(Hot Standby Router Protocol，热备份路由器协议)</strong><br>
<strong>GLBP(Gateway Load Balancing Protocol，网关负载均衡协议)</strong>。在网络规划时通常将解决此类问题的技术称为冗余网关技术，VRRP是国际标准协议，多见于国产设备及网络平台，GLBP与HSRP是思科网络的专有协议，通常只应用在其私有平台。</p>
<h2 id="VRRP">VRRP</h2>
<p>VRRP是由IETF提出的解决局域网中配置静态网关出现单点失效现象的路由协议，1998年推出正式的RFC2338协议标准。</p>
<p>可以将VRRP理解成一种选择协议，它可以把一个虚拟路由器担负的任务动态分配到局域网上的VRRP路由器中的一台。控制虚拟路由器IP地址的VRRP路由器称为主路由器，它负责转发数据包到这些虚拟IP地址。一旦主路由器不可用，这种选择过程就提供了动态的故障转移机制，允许虚拟路由器的IP地址作为终端主机的默认第一跳路由器。这样主机发出的目的地址不在本网段的报文将被通过缺省网关发往三层交换机，从而实现了主机和外部网络的通信。</p>
<p>也可以将VRRP理解成一种路由容错协议，也可以叫作备份路由协议。当缺省路由器down掉(即端口关闭)之后，内部主机将无法与外部通信，如果路由器设置了VRRP，那么这时，虚拟路由将启用备份路由器，从而实现全网通信。在VRRP协议中，有两组重要的概念:VRRP路由器和虚拟路由器，主控路由器和备份路由器。VRRP路由器是指运行VRRP的路由器，是物理实体:虚拟路由器是指VRRP协议创建的，是逻辑概念。一组VRRP路由器协同工作，共同构成一台虚拟路由器。该虚拟路由器对外表现为一个具有唯一固定的IP地址和MAC地址的逻辑路由器。处于同一个VRRP组中的路由器具有两种互斥的角色:主控路由器和备份路由器。一个VRRP组中有且只有一台处于主控角色的路由器，可以有一个或者多个处于备份角色的路由器。VRRP协议从路由器组中选出一台作为主控路由器，负责ARP解析和转发IP数据包，组中的其他路由器作为备份的角色井处于待命状态，当由于某种原因，主控路由器发生故障时，其中的一台备份路由器能在瞬间的时延后升级为主控路由器，由于此切换非常迅速而且不用改变IP地址和MAC地址，故对终端使用者系统是透明的。</p>
<h2 id="HSRP">HSRP</h2>
<p>热备份路由器协议HSRP)的设计目标是支持特定情况下，IP流量失败转移不会引起混乱，并允许主机使用单路由器，以及即使在实际第一跳路由器使用失败的情形下仍能维护路由器间的连通性。</p>
<p>负责转发数据包的路由器称为主动路由器(Active Router)。一旦主动路由器出现故障，HSRP将激活备份路由器(Standby Routers)取代主动路由器。HSRP协议提供了一种决定使用主动路由器还是备份路由器的机制，并指定一个虚拟的IP地址作为网络系统的缺省网关地址。如果主动路由器出现故障，备份路由器(StandbyRouters)承接主动路由器的所有任务，并且不会导致主机连通中断现象。</p>
<p>HSRP运行在UDP上，采用端口号1985。路由器转发协议数据包的源地址使用的是实际IP地址，而并非虚拟地址，正是基于这一点，HSRP路由间能相互识别。</p>
<p>实现HSRP的条件是系统中有多台路由器，它们组成一个“热备份组”，这个组形成一个虚拟路由器。在任一时刻，一个组内只有一个路由器是活动的，并由它来转发数据包，如果活动路由器发生了故障，将选择一个备份路由器来替代活动路由器，但是在本网络内的主机看来，虚拟路由器没有改变。所以主机仍然保持连接，没有受到故障的影响<br>
为了减少网络的数据流量，在设置完活动路由器和备份路由器之后，只有活动路由器和备份路由器定时发送HSRP报丈。如果活动路由器失效，备份路由器将接管成为活动路由器。如果备份路由器失效或者变成了活跃路由器，将由另外的路由器被选为备份路由器。<br>
HSRP协议利用一个优先级方案来决定哪个配置了HSRP协议的路由器成为默认的主动路由器。路由器的缺省优先级是100，所以如果只设置一个路由器的优先级高于100，则该路由器将成为主动路由器。<br>
通过在设置了HSRP协议的路由器之间广播HSRP优先级，HSRP协议选出当前的主动路由器。当在预先设定的一段时间内主动路由器不能发送hello消息时，优先级最高的备用路由器变为主动路由器。路由器之间的包传输对网络上的所有主机来说都是透明的。</p>
<h2 id="GLBP">GLBP</h2>
<p>与HSRP、VRRP不同的是，GLBP不仅提供冗余网关，还在各网关之间提供负载均衡，而HSRP、VRRP都必须选定一个活动路由器，而备用路由器则处于闲置状态。和HSRP不同的是，GLBP可以绑定多个MAC地址到虚拟IP，从而允许客户端选择不同的路由器作为其默认网关，而网关地址仍使用相同的虚拟IP，从而实现一定的冗余。</p>
<p>优先级最高的路由器成为活动路由器，称作Acitve Virtual Gateway(AVG)，其他非AVG提供元余。某路由器被推举为AVG后，AVG分配虚拟的MAC地址给其他GLBP组成员。所有的GLBP组中的路由器都转发包，但是各路由器只负责转发与自己的虚拟MAC地址相关的数据包。</p>
<p>通常来说，VRRP、HSRP和GLBP的区别在于是否同时只存在一个物理端口处于ACTIVE状态。VRRP与HSRP的区别在于设备间的认证机制、初始状态、报文数量、安全性等方面略有不同。</p>
<h2 id="VRRP主备备份配置示例">VRRP主备备份配置示例</h2>
<p>VRRP的主备备份配置的连接拓扑图如图所示。PCl通过Switch双归属到RouterA和RouterB。主机以RouterA为默认网关接入Internet，当RouterA故障时，RouterB接替作为网关继续进行工作，实现网关的冗余备份，RouterA故障恢复后，可以重新成为网关。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/VRRP%E4%B8%BB%E5%A4%87%E4%BB%BD.jpg" alt=""><br>
采用VRRP主备备份实现网关冗余备份包括如下步骤:</p>
<p>配置各设备接口IP地址及路由协议，使各设备间网络层连通。</p>
<p>在RouterA和RouterB上配置VRRP备份组。其中，RouterA上配置较高优先级和20秒抢占延时，作为Master设备承担流量转发:RouterB上配置较低优先级，作为备用路由器，实现网关冗余备份。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">(1)配置设备间的网络互连</span><br><span class="line"></span><br><span class="line">#配置设备各接口的IP地址，以RouterA为例。RouterB和RouterC的配置与RouterA类似。</span><br><span class="line">&lt;Huawei&gt;system-view</span><br><span class="line">[Huawei]sysnarne RouterA</span><br><span class="line">[RouterA]interface gigabitethernet 2/0/0</span><br><span class="line">[RouterA-GigabitEthernet2/0/0]ip address 10.1.1.24</span><br><span class="line">[RouterA-GigabitEthernet2/0/0]quit</span><br><span class="line">[RouterA]interface gigabitethernet 1/0/0</span><br><span class="line">[RouterA-GigabitEthernetl/0/0]ip address 192.168.10.124</span><br><span class="line">[RouterA-GigabitEthernetl/0/0]quit</span><br><span class="line"></span><br><span class="line">#配置RouterA、RouterB和RouterC间采用OSPF协议进行互连。以RouterA为例，RouterB和RouterC的配置与RouterA类似。</span><br><span class="line">[RouterA]ospf 1</span><br><span class="line">[RouterA-ospf-1]area 0</span><br><span class="line">[RouterA-ospf-1-area-0.0.0.0]network 10.1.1.0 0.0.0.255</span><br><span class="line">[RouterA-ospf-1-area-0.0.0.0]network 192.168.10.0 0.0.0.255</span><br><span class="line">[RouterA-ospf-1-area-0.0.0.0]quit</span><br><span class="line">[RouterA-ospf-1]quit</span><br><span class="line">(2)配置VRRP备份组。</span><br><span class="line">#在RouterA上创建VRRP备份组1，配置RouterA在该备份组中优先级为120，并配置抢占时间为20s</span><br><span class="line"></span><br><span class="line">[RouterA]interface gigabitethemet2/0/0</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]vrrp vrid 1 virtual-ip 10.1.1.200</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]vrrp vrid 1 priority 120</span><br><span class="line">[RouterA-GigabitEthernet2/0/0]vrrp vrid 1 preempt-mode timer delay 20</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]quit</span><br><span class="line"></span><br><span class="line">#在RouterB上创建VRRP备份组1，其在该备份组中的优先级为缺省值100。</span><br><span class="line"></span><br><span class="line">[RouterB]interface gigabitethernet 2/0/0</span><br><span class="line">[RouterB-GigabitEthernet2/0/0]vrrp vrid 1 virtual-ip 10.1.1.200</span><br><span class="line">[RouterB-GigabitEthernet2/0/0]quit</span><br><span class="line"></span><br><span class="line">(3)测试配置结果。</span><br><span class="line"></span><br><span class="line">#完成上述配置以后，在RouterA和RouterB上分别执行display vrrp命令，可以看到RouterA在备份组中的状态为Master,RouterB在备份组中的状态为Backup。</span><br><span class="line">[RouterA]display vrrp</span><br><span class="line">GigabitEthemet2/0/0 |Virtual Router 1</span><br><span class="line">State:Master</span><br><span class="line">VirtualIP:10.1.1.200</span><br><span class="line">MasterIP:10.1.1</span><br><span class="line">PriorityRun:120</span><br><span class="line">PriorityConfig:120</span><br><span class="line">MasterPriority:120</span><br><span class="line">Preempt:YES DelayTime:20s</span><br><span class="line">TimerRun·1s</span><br><span class="line">TimerConfig:1s</span><br><span class="line">Authtype:NONE</span><br><span class="line">VirtualMAC:0000-5e00-0101</span><br><span class="line">CheckTTL:YES</span><br><span class="line">Configtype.normal-vrrp</span><br><span class="line">Backup-forward:disabled</span><br><span class="line">Createtime:2012-05-11 11:39:18</span><br><span class="line">Lastchangetime:2021-05-26 11:38:58</span><br><span class="line">[RouterB]display vrrp</span><br><span class="line">GigabitEthemet2/0/0|VirtualRouter1</span><br><span class="line">State:Backup</span><br><span class="line">Virtual IP:10.1.1.200</span><br><span class="line">Master IP:10.1.1.1</span><br><span class="line">PriorityRun:100</span><br><span class="line">PriorityConfig:100</span><br><span class="line">MasterPriority:120</span><br><span class="line">Preempt:YES DelayTime:0s </span><br><span class="line">Timer Run.1s</span><br><span class="line">Timer Config:1s</span><br><span class="line">Auth type:NONE</span><br><span class="line">Virtual MAC:0000-5e00-0101</span><br><span class="line">Check TTL:YES</span><br><span class="line">Configtype:normal-vrrpBackup-forward:disabled</span><br><span class="line">Createtime:2021-05-1111:39:18</span><br><span class="line">Lastchangetime:2021-05-2611:38:58</span><br><span class="line"></span><br><span class="line">#在RouterA的接口GE2/0/0上执行shutdown命令,模拟RouterA出现故障</span><br><span class="line">[RouterA]interface gigabitethemet2/0/0</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]shutdown</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]quit</span><br><span class="line"></span><br><span class="line">#在RouterB上执行display vrrp命令查看VRRP状态信息，可以看到RouterB的状态是Master</span><br><span class="line">[RouterB]display vrrp</span><br><span class="line"></span><br><span class="line">GigabitEthemet2/0/0|VirtualRouter1</span><br><span class="line"></span><br><span class="line">State:Master</span><br><span class="line">Virtual IP:10.1.1.200</span><br><span class="line">Master IP:10.1.1.2</span><br><span class="line">PriorityRun:100</span><br><span class="line">PriorityConfig:100</span><br><span class="line">MasterPriority:100</span><br><span class="line">Preempt:YES DelayTime:0s</span><br><span class="line">TimerRun:1s</span><br><span class="line">TimerConfig:1s</span><br><span class="line">Authtype:NONE</span><br><span class="line">Virtual MAC:0000-5e00-0101</span><br><span class="line">Check TTL:YES</span><br><span class="line">Config type:normal-vrrp</span><br><span class="line">Backup-forward:disabled</span><br><span class="line">Create time:2021-05-11 11:39:18</span><br><span class="line">Last change time:2021-05-26 11:38:58</span><br><span class="line"></span><br><span class="line">#在RouterA的接口GE2/0/0上执行undo shutdown命令，等待20秒后，在RouterA上执行display vrrp命令查看VRRP状态信息，可以看到RouterA的状态恢复成Master。</span><br><span class="line"></span><br><span class="line">[RouterA]interface gigabitethemet 2/0/0</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]undo shutdown</span><br><span class="line">[RouterA-GigabitEthemet2/0/0]quit</span><br><span class="line">[RouterA]display vrrp</span><br><span class="line">GigabitEthemet2/0/0|VirtualRouter1</span><br><span class="line">State:Master</span><br><span class="line">VirtualIP:10.1.1.200</span><br><span class="line">MasterIP:10.1.1.1</span><br><span class="line">PriorityRun:120</span><br><span class="line">PriorityConfig:120</span><br><span class="line">MasterPriority:120</span><br><span class="line">Preempt:YESDelayTime:20s</span><br><span class="line">TimerRun:1s</span><br><span class="line">TimerConfig:1s</span><br><span class="line">Auth type:NONE</span><br><span class="line">Virtual MAC:OOOO-5e00-0101</span><br><span class="line">Check TTL:YES</span><br><span class="line">Config type:normal-vrrp</span><br><span class="line">Backup-forward:disabled</span><br><span class="line">Create time:2021-05-11 11:39:18</span><br><span class="line">Last change time:2021-05-26 11:38:58</span><br></pre></td></tr></table></figure>
<h1>以太环网保护技术</h1>
<p>以太环网技术日趋成熟且成本低廉，在城域网和企业网采用以太环网已经成为一种趋势。但以太网协议采用的报文分发复制机制在解决设备“相互认识 ”的同时也容易 引发“广播风暴 ”，因此在以太环网的构建时就必须考虑采用什么样的保护技术来避免此类故障的产生。</p>
<p>通常情况下， 解决二层网络环路问题的技术是 STP， 因其收敛的时间比较长(秒级) ， 并不适用于主干线路的保护。 2004年 6月， IEEE802.17标准规范了弹性分组环(Resilient Packet Ring, RPR) 的介质访问控制方法、物理层接口以及层管理参数， 并提出了用于环路检测和配置、 失效恢复以及带宽管理的一系列协议。 IEEE802.17标准也定义了环网与各种物理层的接口和系统管理信息库。 RPR支持的数据速率可达10Gbps。 RPR针对承载IP业务进行了优化， 是 一种相对典型的以太环网的保护技术 。</p>
<h2 id="弹性分组环">弹性分组环</h2>
<p>RPR 的体系结构如图所示。 MAC 服务接口提供上层协议的服务原语: MAC 控制子<br>
层控制 MAC 数据通路， 维护 MAC 状态， 并协调各种 MAC 功能的相互作用; MAC 数据通路子层提供数据传输功能: MAC子层通过PHY服务接口发送/接收分组。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/RPR%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.jpg" alt=""><br>
RPC采用了双环结构，由内层的环 1 (Ringlet 1)和外层的环 0 (Ringlet0)组成，每个环都是单方向传送，如图所示。相邻工作站之间的跨距( Span)包含传送方向相反的两条链路(Link) 。如果X站接收Y站发出的分组，则X是Y的下游站，而Y是X的上游站。 RPR 支持多达 255 个工作站，最大环周长为2000km。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/RPR%E6%8B%93%E8%A1%A5%E7%BB%93%E6%9E%84.jpg" alt=""></p>
<p>RPR 中包括如下关键技术。<br>
帧结构<br>
RPR 位于数据链路层( Data Link)，包括逻辑链路控制子层( LLC)、 MAC 控制子层 、MAC 数据通路子层。 LLC 与 MAC 控制子层之间是 MAC 服务接口 。 MAC 服务接口支持把来自 LLC 的数据传送到一个或多个远端同样的逻辑链路控制子层。 MAC 控制子层执行与特定小环无关的数据寻路行为和维护 MAC 状态所需要的控制行为 。 MAC 控制子层与 MAC 数据通道子层之间发送或接收RPRMAC帧。MAC 数据通路子层则与某个特定的小环之间执行访问控制 和数据传送。物理层服务接口用于 MAC 数据通路子层向物理媒介发送或从物理媒介接收RPRMAC 帧 。</p>
<p>RPRMAC对数据帧的处理方式<br>
RPRMAC对数据帧的处理方式有上环、下环、过环以及剥离4种。</p>
<p>上环是指本点用户端口向环上其他站点发送信息时需要进行上环操作，通过拓扑发现和路由表项决定其目的站点地址以及环选择 ， 根据对应的优先级送入相应的队列，最后产生 RPR 帧头后插入到各环端口 。</p>
<p>下环是指本点从环上接收其他站点发送过来的到本点的单播帧或多播帧，经过 StackVLAN过滤后接收。对于单播帧，将其从环上剥离井发送到用户端口:对于多擂帧，将其发送到用户端口的同时进行过环操作 。</p>
<p>过环是指本点从环上接收的帧根据其优先级(A、 B、 C)分别放入 PTQ 和 STQ 转发通道，发送时将 PTQ 和 STQ 队列中的数据帧直接插入源环发送端口 。</p>
<p>剥离是指本点从环上接收的帧不再继续向下传递 ，到本点终结 。</p>
<h2 id="公平算法原理">公平算法原理</h2>
<p>RPR 技术所采用的公平算法是一种保证环上所有站点之间公平性的机制，通过这种算法可以达到带宽的动态调整和共享的目的。 RPR 公平算法的主要作用有两个: 一是应用于从 MAC 客户来的低优先级服务和超额中优先级服务(即中优先级服务中 EIR 数据帧)的业务，对于B类CIR以及A类业务不进行控制 : 二是分别控制两个子环的公平带宽，即每个RPRMAC有两个互相独立的公平协议分别调整上环的带宽 。<br>
RPR公平算法是通过对阻塞的检测来触发带宽调整而实现的 。当环上某一个节点发生阻塞时，它就会在相反的环上向上行节点发布一个公平速率， 当上行站点收到这个公平速率时，就调整自己的发送速率以不超过公平速率。接收到这个公平速率的站点会根据不同情况做出两种反应: 若当前节点阻塞，它就在自己的公平速率(通过本点的add_rate和归一化的权重得到) 和收到的公平速率之间选择最小值公布给上行节点 : 若当前节点不阻塞，节点就将公平速率向上游继续传递 。</p>
<h2 id="拓扑发现原理">拓扑发现原理</h2>
<p>通过 RPR 的拓扑发现原理，可以使每个站点都能了解环的完整结构、各点距离自身的跳数以及环上各个站点所具备的能力等 ，从而为环选择 、 公平算法、保护等单元提供决策依据 。 RPR拓扑发现是一种周期性的活动，但是也可以由某一个需要知道拓扑的节点发起，也就是说，某个节点可以在必要的时候产生一个拓扑信息帧(如此节点刚刚进入RPR环中，接收到一个保护切换需求信息或者节点监测到了光纤链路差错)。<br>
RPR的拓扑信息产生周期可以任意配置， 一般为50ms~10s，以50ms为最小分辨率， 默认值为 100ms。</p>
<h2 id="保护原理">保护原理</h2>
<p>RPRMAC 层保护可支持 Steering 保护或 Wrapping 保护，用户可以指配是否同时采用 RPRMAC 层的保护和 SDH 物理层的保护。当同时采用 RPRMAC 层保护和 SDH 保护时 ，可以采用拖延RPR层倒换时间来支持层间倒换，以保证两种倒换不会重叠发生。</p>
<p>RPR 的保护时间有拖延时间和等待恢复时间两种 。 拖延时间为检测到业务失效到启动倒换之间的等待时间(时间范围为 0~10s，步进级别为100ms) ， 在这段时间内如果业务恢复， 将不发生倒换;等待恢复时间为从故障恢复到业务故障状态清除(取消保护状态)之间的等待时间 (时间范围为 0~1440s，步进级别为秒级可设置，默认为 10s)，在这段时间内如果业务失效 ，业务故障状态将不再清除 。</p>
<h1>以太网环保护交换</h1>
<p>在 2008 年 12 月举行的 ITU-TSG15 会议上，对以太环网保护标准 G.8032 的 V1 版本进行修订 ，增加以太网环保护交换 (Ethernet Ring Protection Switching, ERPS)方案，形成 ITU-TG.8032 ERPS 以太环网标准 ， 该标准吸取了 EAPS、 RPR、 SDH、 STP 等众多环网保护技术的优点，优化了检测机制，可以检测双向故障，支持多环、多域的结构， 在实现 50ms 倒换的同时，支持主备，负荷分担多种工作方式，成为二层网络中重要的冗余保护手段 。</p>
<p>下面按照链路正常→链路故障→链路恢复的过程(包括保护倒换操作) ， 介绍基本的单环 组网下 E盯 S 的实现原理。</p>
<p>链路正常<br>
如图所示，由 SwitchA~ SwitchE组成的环路上各设备通信正常。为防止环路产生，ERPS 首先会阻塞 RPL owner端口，如果配置了 RPL neighbour端口，该端口同样会被阻塞，其他端口可以正常转发业务流量。</p>
<p><img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/erps1.jpg" alt=""></p>
<p>ERPS环上的RPL owner端口 以5s的时间间隔为周期向环中其他节点发送 NRRB RAPS报文，表示ERPS环当前链路一切正常。</p>
<p>链路故障</p>
<p>如图所示 ， 当 Switch D 和 Switch E 之间的链路发生故障时， ERPS 协议启动保护倒换机制， 将故障链路的两端端口阻塞 ， 然后放开 RPL owner 端口和 RPL neighbour 端口 ， 这两 个端口重新恢复用户流量的接收和发送，从而保证了流量不中断。 具体处理过程如下:</p>
<p>SwitchD和 SwitchE检测到链路故障，将故障链路上的端口阻塞，并刷新本设备的FDB表项。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/erps2.jpg" alt=""><br>
然后，SwitchD和 SwitchE向外发送携带本地端口链路故障消息的SF RAPS报文，即一旦感知到链路故障， Switch D 和 Switch E 会连续发送 3 个相同的 RAPS 报文 ，然后 以 5s 的间隔持续稳定发送 。<br>
其他设备收到 SwitchD和 SwitchE发送的 SFRAPS报文后，都刷新本设备的 FDB表项。 当 Switch C 设备( RPLowner 端口所在设备)收到该 RAPS 报文后，放开 RPL owner 端口 ， 并刷新自己的FDB表项。 同样， 当 SwitchB设备(RPL neighbour端口所在设备)收到 RAPS报文后，放开 RPL neighbour端口，井刷新自己的 FDB 表项。</p>
<p>链路恢复</p>
<p>链路恢复正常后 ， 如果 ERPS 环配置的是回切模式， RPL owner 端口所在设备会重新阻塞 RPL链路上的流量， 故障链路重新被用来完成用户流量的传送。 如果 ERPS环配置的是非回切模式，阻塞链路还保持在原来的故障链路上，不会重新切回到 RPL上。 以回切模式为例， 具体恢复过程如下:</p>
<p>当 SwitchD和 SwitchE之间的链路恢复后 ，SwitchD和 SwitchE为了防止收到过期的 RAPS 协议报文， 分别启动 Guard Timer定时器， 在该定时器超时前不接收其他 RAPS 协议报文。 同时 Switch D 和 Switch E 会向外发送 NRRAPS 报文 。</p>
<p>当 RPLowner 端口所在设备( Switch C) 收到 NR RAPS 报文后，启动 WTR Timer 定时器 。 当该定时器超时后， RPLowner端口被阻塞， 同时向外发送 NRRB RAPS 报文。</p>
<p>当 Switch D 和 Switch E 收到 Switch C 发送的 NRRB RAPS 协议报文后 ， 将自己设备上原来阻塞的端口放开， 停止发送 NR RAPS 协议报文并且完成 FDB 表项的刷新。 其他设备收到 SwitchC发送的NRRBRAPS协议报文后， 也完成FDB表项的刷新。</p>
<p>保护倒换<br>
强制切换<br>
如图所示 ， 当由 Switch A~ Switch E 组成的环路上各设备通信正常时 ， 在 Switch E设备与SwitchD相连的端口上执行强制切换将端口阻塞， RPLowner端口和RPLneighbour端口同样会被放开 ， 这两个端口重新恢复用户流量的接收和发送 ， 从而保证了流量不中断 。 具体 处理过程如下:<br>
Switch E 与 Switch D 相连的端口被强制阻塞后 ，刷新本设备的 FDB 表项 。<br>
<img src="/img/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/erps3.jpg" alt=""></p>
<h1>城域网</h1>
<p>城域网比局域网的传输距离远，能够覆盖整个城市范围，城域网有更大的传输容量， 更高的传输效率，还要有多种接入手段，以满足不同用户的需要。城域网作为开放型的综合平台， 要求能够提供分组传输的数据 、语音 、图像和视频等多媒体综合业务 。</p>
<p>城域以太网论坛(Metro Ethernet Forum, MEF)是由网络设备制造商和网络运营商组成的非营利性组织 ， 专门从事城域以太网的标准化工作 。 MEF 的承载以太网( Carrier Ethernet) 技术规范提出了以下几种业务类型 。</p>
<p>以太网专用线( Ethernet Private Line, EPL) 。 在一对用户以太网之间建立固定速率的点对点专线连接。</p>
<p>以太网虚拟专线( Ethernet Virtual Private Line, EVPL)。在一对用户以太网之间通过第三层技术提供点对点的虚拟以太网连接，支持承诺的信息速率(CIR) 、峰值信息速率 (PIR) 和突发式通信。</p>
<p>以太局域网服务(E-LAN Services)。由运营商建立一个城域以太网，在用户以太网之间提供多点对多 的第二层连接 ，任意两个用户以太网之间都可以通过城域以太网通信。<br>
其中的第 3 种技术被认为是最有前途的解决方案。提供 E-LAN 服务的基本技术是802.lq的 VLAN帧标记。假定各个用户的以太网称为C-网，运营商建立的城域以太网称为 S-网 。 如果不同 C-网中的用户要进行通信，以太帧在进入用户网络接口( User-Network Interface, UNI)时被插入一个 S-VID ( Server Provider-VLAN ID)字段 ， 用于标识S-网中的传输服务， 而用户的VLAN帧标记(C-VID) 则保持不变， 当以太帧到达目标C-网时， S-VID 字段被删除 ，如图所示，这样就解决了两个用户以太网之间透明的数据传输问题。这种技术定义在 IEEE 802.lad 的运营商网桥协议( Provider Bridge Protocol)中 ， 被称为 Q-in-Q 技术。</p>
<p>Q-in-Q 实际上是把用户  VLAN 嵌套在城域以太网的 VLAN 中传送 ， 由于其简单性和有效性而得到电信运营商的青睐。但是这样一来，所有用户的 MAC 地址在城域以太网中都是可见的， 任何 C-网的改变都会影响到 S-网的配置，增加了管理的难度。而且 S-VID字段只有 12位， 只能标识 4096 个不同的传输服务，网络的可扩展性也受到限制 。 从用户角度看，网络用户的 MAC 地址都暴露在整个城域以太网中，使得网络的安全性受到威胁 。</p>
<p>为了解决上述问题， IEEE802.lah标准提出了运营商主干网桥(Provider Backbone Bridge, PBB)协议。所谓主干网桥，就是运营商网络边界的网桥 ，通过 PBB 对用户以太帧再封装一层运营商的 MAC 帧头，添加主干网目标地址和源地址（B-DA,B-SA)、主干网 VLAN标识(B-VID)以及服务标识 （I-SID）等字段，如图所示，由于用户以太帧被封装在主干网以太帧中，所以这种技术被称为 MAC-in-MAC 技术 。<br>
按照 802.lah协议， 主干网与用户网具有不同的地址空间。主干网的核心交换机只处理通常的以太网帧头，仅主干网边界交换机才具有 PBB 功能 。 这样，用户网和 主干网被 PBB 隔离，使得扁平式的以太网变成了层次化结构，简化了网络管理， 保证了网络安全。 802.lah协议规定的服务标识（I-SID)字段为 24 位 ， 可以区分 1600 万种不同的服务 ， 使得网络的扩展性得以提升 。 由于采用了 二层技术 ， 没有复杂的信令机制，因此设备成本和维护成本较低，被认为是城域以太网的最终解决方案。目前，IEEE802.lah标准正在完善之中。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/JYHE.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/JYHE.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">JYhe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/')">网规基础4局域网，广域网</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=网规基础4局域网，广域网&amp;url=http://example.com/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/&amp;pic=/img/default_cover.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络规划设计师<span class="tagsPageCount">6</span></a><a class="post-meta__box__tags" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>基础知识<span class="tagsPageCount">6</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/10/30/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%803%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%EF%BC%8C%E8%B0%83%E5%88%B6%E6%8A%80%E6%9C%AF%E4%B8%8E%E9%80%9A%E4%BF%A1%E9%A2%86%E5%9F%9F/"><img class="prev-cover" src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">3数据编码，调制技术与通信领域</div></div></a></div><div class="next-post pull-right"><a href="/2025/11/05/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%805%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/"><img class="next-cover" src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">网规基础5无线通信网络</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/10/27/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%801%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/" title="1计算机网络历史组成"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-27</div><div class="title">1计算机网络历史组成</div></div></a></div><div><a href="/2025/10/29/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%802%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E6%A6%82%E5%BF%B5/" title="2数据通讯概念"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-29</div><div class="title">2数据通讯概念</div></div></a></div><div><a href="/2025/10/30/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%803%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%EF%BC%8C%E8%B0%83%E5%88%B6%E6%8A%80%E6%9C%AF%E4%B8%8E%E9%80%9A%E4%BF%A1%E9%A2%86%E5%9F%9F/" title="3数据编码，调制技术与通信领域"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-10-30</div><div class="title">3数据编码，调制技术与通信领域</div></div></a></div><div><a href="/2025/11/05/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%805%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/" title="网规基础5无线通信网络"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-11-05</div><div class="title">网规基础5无线通信网络</div></div></a></div><div><a href="/2025/11/19/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%806%E6%97%A0%E7%BA%BF%E4%B8%AA%E4%BA%BA%E7%BD%91/" title="网规基础6无线个人网"><img class="cover" src="/img/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-11-19</div><div class="title">网规基础6无线个人网</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="/img/JYHE.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">局域网</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HDLC%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.</span> <span class="toc-text">HDLC协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-HDLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.HDLC的基本配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-HDLC%E7%9A%84%E5%B8%A7%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.HDLC的帧结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">IEEE802.3标准</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CSMA-CD%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.</span> <span class="toc-text">CSMA&#x2F;CD协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%8C%87%E6%95%B0%E5%90%8E%E9%80%80%E7%AE%97%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">二进制指数后退算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91%E4%BA%92%E8%BF%9E"><span class="toc-number">2.3.</span> <span class="toc-text">局域网互连</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E9%80%9F%E4%BB%A5%E5%A4%AA%E7%BD%91"><span class="toc-number">2.4.</span> <span class="toc-text">高速以太网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91"><span class="toc-number">2.5.</span> <span class="toc-text">虚拟局域网</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">冗余网关技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#VRRP"><span class="toc-number">3.1.</span> <span class="toc-text">VRRP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HSRP"><span class="toc-number">3.2.</span> <span class="toc-text">HSRP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GLBP"><span class="toc-number">3.3.</span> <span class="toc-text">GLBP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VRRP%E4%B8%BB%E5%A4%87%E5%A4%87%E4%BB%BD%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.4.</span> <span class="toc-text">VRRP主备备份配置示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">以太环网保护技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E6%80%A7%E5%88%86%E7%BB%84%E7%8E%AF"><span class="toc-number">4.1.</span> <span class="toc-text">弹性分组环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E5%B9%B3%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">公平算法原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%91%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">4.3.</span> <span class="toc-text">拓扑发现原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E5%8E%9F%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">保护原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">以太网环保护交换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">城域网</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/19/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%806%E6%97%A0%E7%BA%BF%E4%B8%AA%E4%BA%BA%E7%BD%91/" title="网规基础6无线个人网"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础6无线个人网"/></a><div class="content"><a class="title" href="/2025/11/19/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%806%E6%97%A0%E7%BA%BF%E4%B8%AA%E4%BA%BA%E7%BD%91/" title="网规基础6无线个人网">网规基础6无线个人网</a><time datetime="2025-11-19T11:22:37.783Z" title="Created 2025-11-19 19:22:37">2025-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/05/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%805%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/" title="网规基础5无线通信网络"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础5无线通信网络"/></a><div class="content"><a class="title" href="/2025/11/05/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%805%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C/" title="网规基础5无线通信网络">网规基础5无线通信网络</a><time datetime="2025-11-05T10:00:00.000Z" title="Created 2025-11-05 18:00:00">2025-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/" title="网规基础4局域网，广域网"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网规基础4局域网，广域网"/></a><div class="content"><a class="title" href="/2025/11/02/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%804%E5%B1%80%E5%9F%9F%E7%BD%91%EF%BC%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/" title="网规基础4局域网，广域网">网规基础4局域网，广域网</a><time datetime="2025-11-01T19:06:00.000Z" title="Created 2025-11-02 03:06:00">2025-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/30/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%803%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%EF%BC%8C%E8%B0%83%E5%88%B6%E6%8A%80%E6%9C%AF%E4%B8%8E%E9%80%9A%E4%BF%A1%E9%A2%86%E5%9F%9F/" title="3数据编码，调制技术与通信领域"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3数据编码，调制技术与通信领域"/></a><div class="content"><a class="title" href="/2025/10/30/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%803%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%EF%BC%8C%E8%B0%83%E5%88%B6%E6%8A%80%E6%9C%AF%E4%B8%8E%E9%80%9A%E4%BF%A1%E9%A2%86%E5%9F%9F/" title="3数据编码，调制技术与通信领域">3数据编码，调制技术与通信领域</a><time datetime="2025-10-30T08:49:00.000Z" title="Created 2025-10-30 16:49:00">2025-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/29/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%802%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E6%A6%82%E5%BF%B5/" title="2数据通讯概念"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2数据通讯概念"/></a><div class="content"><a class="title" href="/2025/10/29/%E7%BD%91%E8%A7%84%E5%9F%BA%E7%A1%802%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E6%A6%82%E5%BF%B5/" title="2数据通讯概念">2数据通讯概念</a><time datetime="2025-10-29T09:32:00.000Z" title="Created 2025-10-29 17:32:00">2025-10-29</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="JYhe" target="_blank">JYhe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">6</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">1</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>6</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%B8%88/" style="font-size: 0.88rem;">网络规划设计师<sup>6</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;undefined&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("27/10/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 JYhe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.cbd.int/katex@0.16.0/dist/katex.min.css"><script src="https://cdn.cbd.int/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    anzhiyu.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>